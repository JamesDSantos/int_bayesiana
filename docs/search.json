[
  {
    "objectID": "misturas.html#modelos-com-inflação-de-zeros",
    "href": "misturas.html#modelos-com-inflação-de-zeros",
    "title": "8  Misturas de distribuições",
    "section": "8.1 Modelos com inflação de zeros",
    "text": "8.1 Modelos com inflação de zeros\nQuando são observados mais zeros do que o esperado pelo modelo de contagem assumido para a verossimilhança, é usual considerar um modelo com inflação de zeros. Nesse tipo de modelo, assumimos que existe uma variável \\(Z|p\\sim\\hbox{Bernoulli}(\\rho)\\) tal que:\n\\[X=\\left\\{\\begin{array}{ll}0, & \\hbox{se }Z=1\\ \\\\ Y,&\\hbox{se }Z=0\\end{array}\\right.\\] onde \\(Y\\sim h(.|\\theta)\\) é o modelo de contagem. Apenas \\(X\\) é observado e, como\n\\[\\begin{align}P(X=0|\\theta,p)&=P(X=0|Z=0,\\theta)P(Z=0|\\rho)+P(X=0|Z=1,\\theta)P(Z=1|\\rho)\\\\&=(1-\\rho)h(0|\\theta)+\\rho\\end{align}\\] a probabilidade de observar um zero está entre \\(h(0|\\theta)\\) e 1, o que caracteriza a inflação.\nAgora, considere um modelo inflacionado de zeros aumentado:\n\\[f(x,z|\\theta,\\rho)=f(x|z,\\theta)f(z|\\rho)=f(x|z,\\theta)\\rho^z(1-\\rho)^{1-z}.\\] Note que\n\\[f(x|z,\\theta)=\\left\\{\n\\begin{array}{ll}\nh(x|\\theta),&\\hbox{ se }z=0,\\\\\nI(x=0),&\\hbox{ se }z=1\\\\\n\\end{array}\\right.\\] logo, a distribuição conjunta \\(f(x,z|\\theta,\\rho)\\) é dada por\n\\[\\begin{array}{c|cc}\\hline & x=0 & \\hbox{qualquer }x&gt; 0 \\\\ \\hline\nz=0 & h(0|\\theta)(1-\\rho) & h(x|\\theta)(1-\\rho) \\\\\nz=1 & \\rho & 0 \\\\ \\hline\n\\end{array}\n\\] Então,\n\\[\\begin{align}\n\\prod_{i=1}^n f(x_i,z_i|\\theta,\\rho)&=\\prod_{i=1}^n [h(0|\\theta)(1-\\rho)]^{I(x_i=0,z_i=0)}[h(x_i|\\theta)(1-\\rho)]^{I(x_i&gt;0,z_i=0)}\\rho^{I(x_i=0,z_i=1)}\\\\\n&=\\prod_{i=1}^n [h(x_i|\\theta)(1-\\rho)]^{I(z_i=0)}\\rho^{I(x_i=0,z_i=1)}\\\\\n&=\\prod_{i=1}^n(1-\\rho)^{I(z_i=0)}\\rho^{I(x_i=0,z_i=1)}\\prod_{i=1}^n [h(x_i|\\theta)]^{I(z_i=0)}\\end{align}\\] e, notando que \\(I(z_i=0)=1-z_i,\\)\n\\[\\begin{align}\n\\prod_{i=1}^n f(x_i,z_i|\\theta,\\rho)&=\n(1-\\rho)^{n-\\sum_{i=1}^n z_i}\\rho^{\\sum_{i=1}^n z_iI(x_i=0)}\\prod_{i=1}^n [h(x_i|\\theta)]^{1-z_i}\\end{align}\\]\nConsidere, a priori, que \\(\\theta\\) e \\(\\rho\\) são independentes. Seja \\(\\pi(\\theta)\\) a priori para \\(\\theta\\) e considere que \\(\\rho\\sim\\hbox{Beta}(a,b)\\). Então, as condicionais completas para \\(\\theta\\) e \\(\\rho\\) são\n\\[\\begin{align}\n\\pi(\\theta|\\rho,\\boldsymbol{z},\\boldsymbol{x})&\\propto \\prod_{i=1}^n h(x_i|\\theta)^{1-z_i}\\pi(\\theta),\\\\\n\\pi(\\rho|\\theta,\\boldsymbol{z},\\boldsymbol{x})&\\propto \\rho^{\\sum_{i=1}^n z_iI(x_i=0)+a-1}(1-\\rho)^{n-\\sum_{i=1}^n z_i+b-1},\\\\\n\\end{align}\\]\nPara a condicional completa de \\(z_i\\), notemos que \\[P(Z_i=1|x_i&gt;0)=\\frac{P(Z_i=1,X_i&gt;0)}{P(X_i&gt;0)}=0,\\] e que\n\\[P(Z_i=z|x_i=0)= \\left\\{\\begin{array}{ll}\\frac{P(Z_i=0,X_i=0)}{P(X_i=0)}=\\frac{h(0|\\theta)(1-\\rho)}{\\rho+(1-\\rho)h(0|\\theta)},&,z=0\\\\\n\\frac{P(Z_i=1,X_i=0)}{P(X_i=0)}=\\frac{\\rho}{\\rho+(1-\\rho)h(0|\\theta)},&z=1\\end{array}\\right.,\\] logo \\[\\pi(z_i|\\theta,\\rho,\\boldsymbol{x},\\boldsymbol{z}_{(-i)})=\\left\\{\\begin{array}{ll}\\hbox{Bernoulli}\\left( \\frac{\\rho}{\\rho+(1-\\rho)h(0|\\theta)}\\right),&\\hbox{ se }x_i=0\\\\\nI(z_i=0),&\\hbox{ se } x_i&gt;0\\\\ \\end{array}\\right.\\]\nPortanto, um amostrador de Gibbs para um modelo inflacionado de zeros é\n\nAmostrador de Gibbs para o modelo inflado de zeros\nFaça \\(j=0\\) e dê os valores iniciais \\(\\theta^{(0)}\\) e \\(\\rho^{(0)}\\).\nNo \\(j\\)-ésimo passo:\n\nPara \\(i\\in\\{1,\\ldots,n\\}\\), se \\(x_i&gt;0\\) faça \\(z_i=0\\). Senão, simule \\[z_i^{(j)}\\sim \\hbox{Bernoulli}\\left(\\frac{\\rho^{(j-1)}}{\\rho^{(j-1)}+(1-\\rho^{(j-1)})h(x_i|\\theta^{(j-1)})}\\right)\\]\nSimule \\(\\rho^{(j)}\\sim\\hbox{Beta}(a+\\sum_{i=1}^n z_i^{(j)}I(x_i=0),b+n-\\sum_{i=1}^n z_i^{(j)})\\)\nSimule \\(\\theta^{(j)}\\) de \\[\\pi(\\theta|\\rho^{(j)},\\boldsymbol{z}^{(j)},\\boldsymbol{x})\\propto \\prod_{i=1}^n h(x_i|\\theta^{(j)})^{1-z_i^{(j)}}\\pi(\\theta^{(j)}).\\]\n\n\n\nExemplo - A Poisson inflada de zeros \nNeste exemplo, vamos considerar que a distribuição da contagem é Poisson(\\(\\theta\\)) e que \\(\\theta\\sim\\hbox{Gama}(r,s)\\). Então,\n\\[\\begin{align}\n\\pi(\\theta|\\rho^{(j)},\\boldsymbol{z}^{(j)},\\boldsymbol{x})&\\propto \\prod_{i=1}^{n} h(x_{i} | \\theta )^{ 1-z_{i}^{(j)} }\\pi(\\theta)=\n\\prod_{i=1}^{n} \\left[\\frac{ e^{-\\theta}\\theta^{x_i} }{x_i!}\\right]^{1-z_{i}^{(j)}}\\frac{s^r}{\\Gamma(r)}\\theta^{r-1} e^{-s\\theta}\\\\&\\propto \\theta^{\\sum_{i=1}^n x_i(1-z_i^{(j)})+r-1}e^{-(n-\\sum_{i=1}^n z_i^{(j)}+s)\\theta}\n\\end{align},\\]\nou seja, \\(\\theta^{(j)}|\\rho^{(j)},\\boldsymbol{z}^{(j)},\\boldsymbol{x}\\sim\\hbox{Gama}(\\sum_{i=1}^n x_i(1-z_i^{(j)})+r,n-\\sum_{i=1}^n z_i^{(j)}+s)\\)\n\n\nOs dados abaixo representam o número anual de furacões atlânticos grandes (categoria 4 ou 5) entre 1987 e 2012, nos Estados Unidos.\n\nfur &lt;-  c(0, 0 ,1,\n0, 0, 1, 0, 0, 1, 0, 0, 2, 2,\n0, 0, 1, 1, 3, 4, 0, 0, 2, 0,\n0, 0, 0)\n\nA frequência relativa de zeros é 0,58. Considerando o modelo Poisson\\((\\theta)\\) com \\(\\pi(\\theta)\\propto \\theta^{-1}\\), temos que\n\nr1 &lt;- sum(fur)\ns1 &lt;- length(fur)\nplot(table(fur)/s1, type= 'p', xlab='No. anual de mortes pod fur', ylab = 'Probabilidade', col = 'cyan3', pch=16)\nlines(0:4,table(fur)/s1, col = 'cyan3')\npoints(0:4, dnbinom(0:4, size = r1, prob = s1/(1+s1)), pch=16, col = 'brown')\nlines(0:4, dnbinom(0:4, size = r1, prob = s1/(1+s1)), col = 'brown')\n\nlegend('bottomleft',c('Freq. relativa','Pred. post. Poisson'), fill=c('cyan3','brown'), bty='n')\n\n\n\n\n\n# hiperparâmetros para rho\na = b = 1\n\n# hiperparâmetros para theta\nr=.1\ns=.1\n\n# tamanho da amostra\nn &lt;- length(fur) \n\n# valores iniciais da cadeia\ntheta &lt;- mean(fur)\nrho &lt;- mean(fur == 0)\n\n# amostrador de Gibbs\nB &lt;- 50000\nfor(i in 1:B){\n  # simulando z\n  z &lt;- NULL\n  prob &lt;- rho[i]/ ( (1-rho[i])*dpois(0,theta[i]) + rho[i])\n  for(j in 1:n){\n    if(fur[j] &gt;0){ z[j] &lt;- 0} else{\n      z[j] &lt;- rbinom(1,1,prob)\n    }\n  }\n\n  # simulando rho\n  rho[i+1] &lt;- rbeta( 1, a + sum( z * (fur == 0)) , n- sum(z)+ b )\n  \n  # simulando theta\n  theta[i+1] &lt;- rgamma(1, sum( fur*(1-z) ) + r,  n - sum(z) + s)\n}\n\nVamos descartar a metade das simulações e usar um thinning igual a 15:\n\ntheta_sim &lt;- theta[seq(B/2,B,15)]\nrho_sim &lt;- rho[seq(B/2,B,15)]\n\noo &lt;- par(mfrow=c(2,2))\nts.plot(theta_sim, lwd = 2)\nts.plot(rho_sim, lwd = 2)\nacf(theta_sim)\nacf(rho_sim)\n\n\n\n\nVamos estimar as probabilidade de ocorrerem \\(k\\) mortes via preditiva posteriori:\n\n# tamanho do vetor simulado\nBs &lt;- length(theta_sim)\n\nx_til &lt;- array( NA_real_, c(Bs,n))\nfor(j in 1:Bs){\n  z &lt;- rbinom( n, 1, rho_sim[j])\n  x_til[j,] &lt;- (1-z)*rpois(n, theta_sim[j])\n}\n\n# probabilidades estimadas via ZIP\np_zip &lt;- prop.table(table(x_til))\n\np_zip\n\nx_til\n           0            1            2            3            4            5 \n0.6152231092 0.1960223340 0.1147616631 0.0487979327 0.0174888099 0.0056527156 \n           6            7            8 \n0.0015227724 0.0004153016 0.0001153615 \n\n\nAbaixo mostramos as probabilidades preditas do modelo ZIP, do modelo Poisson a e frequência relativa.\n\nr1 &lt;- sum(fur)\ns1 &lt;- length(fur)\nplot(table(fur)/s1, type= 'p', xlab='No. anual de mortes pod fur', ylab = 'Probabilidade', col = 'cyan3', pch=16)\nlines(0:4,table(fur)/s1, col = 'cyan3')\npoints(0:4, dnbinom(0:4, size = r1, prob = s1/(1+s1)), pch=16, col = 'brown')\nlines(0:4, dnbinom(0:4, size = r1, prob = s1/(1+s1)), col = 'brown')\npoints(names(p_zip),p_zip, pch=16,col = 'magenta')\nlines(names(p_zip),p_zip,col = 'magenta')\n\nlegend('bottomleft',c('Freq. relativa','Pred. post. Poisson', 'Pred. post. ZIP'), fill=c('cyan3','brown', 'magenta'), bty='n')\n\n\n\n\n\n\n8.1.1 Exercício\n\nAbaixo, segue o número anual de tornados em Lafayette Parish, Louisiana, entre 1950 e 2012.\n\ntor &lt;- c(0, 0,0, 1, 0, 0, 0, 1, 0, 0,\n1, 0, 0, 0, 1, 1, 0, 0, 0, 2,\n0, 0, 0, 0, 1, 3, 0, 2, 1, 0,\n1, 0, 0, 1, 0, 1, 0, 0, 2, 1,\n0, 1, 2, 0, 0, 1, 0, 1, 2, 0,\n0, 0, 3, 0, 2, 0, 1, 1, 3, 0,\n1, 1, 1)\n\n\nAjuste o modelo Poisson.\nAjuste o modelo Poisson inflado de zeros."
  },
  {
    "objectID": "misturas.html#exercício",
    "href": "misturas.html#exercício",
    "title": "8  Misturas de distribuições",
    "section": "8.2 Exercício",
    "text": "8.2 Exercício\n\nAbaixo, segue o número anual de tornados em Lafayette Parish, Louisiana, entre 1950 e 2012.\n\ntor &lt;- c(0, 0,0, 1, 0, 0, 0, 1, 0, 0,\n1, 0, 0, 0, 1, 1, 0, 0, 0, 2,\n0, 0, 0, 0, 1, 3, 0, 2, 1, 0,\n1, 0, 0, 1, 0, 1, 0, 0, 2, 1,\n0, 1, 2, 0, 0, 1, 0, 1, 2, 0,\n0, 0, 3, 0, 2, 0, 1, 1, 3, 0,\n1, 1, 1)\n\n\nAjuste o modelo Poisson.\nAjuste o modelo Poisson inflado de zeros."
  },
  {
    "objectID": "misturas.html",
    "href": "misturas.html",
    "title": "8  Misturas de distribuições",
    "section": "",
    "text": "9 Mistura escalonada de normais\nDizemos que \\(X|\\boldsymbol{\\theta},\\boldsymbol{p},\\kappa\\) é um modelo de mistura finito se sua função de densidade/probabilidade é dada por\n\\[f(x| \\boldsymbol{\\theta},\\boldsymbol{p} ,\\kappa )=\\sum_{k=1}^\\kappa p_k f_k(x|\\boldsymbol{\\theta}_k).\\]\nCada função \\(f(.|\\boldsymbol{\\theta}_k)\\) é denominada componente da mistura e o número de componentes pode ser desconhecido.\nAssim como o modelo com zeros inflacionados, podemos utilizar uma variável latente \\(\\textbf{z}_i|\\kappa=(z_{i,1},\\ldots,z_{i,\\kappa})\\sim\\hbox{Multinomial}(p_1\\ldots,p_\\kappa|\\sum_{k=1}^\\kappa z_{ik}=1)\\), obtendo o seguinte modelo aumentado\n\\[f(x_i|\\boldsymbol{\\theta},\\textbf{z}_i,\\kappa)=\\prod_{k=1}^\\kappa \\left[f\\left(x_i|\\boldsymbol{\\theta}_k\\right)\\right]^{z_{i,k}}\\]\nA função de verossimilhança aumentada para este modelo é\n\\[\\prod_{i=1}^n f(x_i|\\boldsymbol{\\theta},\\textbf{z}_i,\\kappa)=\\prod_{i=1}^n\\prod_{k=1}^\\kappa \\left[f\\left(x_i|\\boldsymbol{\\theta}_k\\right)\\right]^{z_{i,k}}.\\]\nConsidere as prioris \\(\\pi(\\boldsymbol{\\theta}|\\kappa)=\\prod_{k=1}^\\kappa \\pi(\\boldsymbol{\\theta}_k)\\) e \\(\\textbf{p}|\\kappa\\sim\\hbox{Dirichlet}(a_1,\\ldots,a_\\kappa)\\), onde \\[f(\\textbf{p}|\\kappa)\\propto \\prod_{k=1}^\\kappa p_k^{a_k-1}\\] com \\(\\sum_{k=1}^\\kappa p_k=1\\). As condicionais completas para este problema são\n\\[\\tilde{p}_k=\\frac{p_kf(x_i|\\boldsymbol{\\theta}_k)}{\\sum_{k=1}^\\kappa p_kf(x_i|\\boldsymbol{\\theta}_k)}\\] * \\(f(\\textbf{p}|resto)\\propto \\prod_{k=1}^\\kappa p_k^{\\sum_{i=1}^n z_{i,k}+a_k-1}\\), ou seja \\(\\textbf{p}|resto\\sim\\hbox{Dirichlet}(a_1+\\sum_{i=1}^n z_{i,1},\\ldots,a_\\kappa+\\sum_{i=1}^n z_{i,\\kappa})\\)\nSe necessário, podemos atrbuir a priori \\[\\pi(\\kappa)=\\frac{1}{M},\\kappa=1,2,\\ldots,M\\] para obter a condicional completa \\[\\pi(\\kappa|resto)=\\frac{\\prod_{i=1}^n\\prod_{k=1}^\\kappa f(x_i|\\boldsymbol{\\theta}_k)^{z_{i,k}}\\pi(\\boldsymbol{\\theta}_k)\\pi(\\textbf{p}|\\kappa)\\pi(\\textbf{z}_i|\\kappa)}{\\sum_{\\kappa=1}^M \\prod_{i=1}^n\\prod_{k=1}^\\kappa f(x_i|\\boldsymbol{\\theta}_k)^{z_{i,k}}\\pi(\\boldsymbol{\\theta}_k)\\pi(\\textbf{p}|\\kappa)\\pi(\\textbf{z}_i|\\kappa)},\\kappa=1,\\ldots,M.\\]"
  },
  {
    "objectID": "misturas.html#mistura-escalonada-de-normais",
    "href": "misturas.html#mistura-escalonada-de-normais",
    "title": "8  Misturas de distribuições",
    "section": "8.2 Mistura escalonada de normais",
    "text": "8.2 Mistura escalonada de normais"
  },
  {
    "objectID": "misturas.html#misturas-finitas-com-número",
    "href": "misturas.html#misturas-finitas-com-número",
    "title": "8  Misturas de distribuições",
    "section": "8.3 Misturas finitas com número",
    "text": "8.3 Misturas finitas com número\nDizemos que \\(X|\\boldsymbol{\\theta},\\boldsymbol{p},\\kappa\\) é um modelo de mistura finito se sua função de densidade/probabilidade é dada por\n\\[f(x| \\boldsymbol{\\theta},\\boldsymbol{p} ,\\kappa )=\\sum_{k=1}^\\kappa p_k f_k(x|\\boldsymbol{\\theta}_k).\\]\nCada função \\(f(.|\\boldsymbol{\\theta}_k)\\) é denominada componente da mistura e o número de componentes pode ser desconhecido.\nAssim como o modelo com zeros inflacionados, podemos utilizar uma variável latente \\(\\textbf{z}_i|\\kappa=(z_{i,1},\\ldots,z_{i,\\kappa})\\sim\\hbox{Multinomial}(p_1\\ldots,p_\\kappa|\\sum_{k=1}^\\kappa z_{ik}=1)\\), obtendo o seguinte modelo aumentado\n\\[f(x_i|\\boldsymbol{\\theta},\\textbf{z}_i,\\kappa)=\\prod_{k=1}^\\kappa \\left[f\\left(x_i|\\boldsymbol{\\theta}_k\\right)\\right]^{z_{i,k}}\\]\nA função de verossimilhança aumentada para este modelo é\n\\[\\prod_{i=1}^n f(x_i|\\boldsymbol{\\theta},\\textbf{z}_i,\\kappa)=\\prod_{i=1}^n\\prod_{k=1}^\\kappa \\left[f\\left(x_i|\\boldsymbol{\\theta}_k\\right)\\right]^{z_{i,k}}.\\]\nConsidere as prioris \\(\\pi(\\boldsymbol{\\theta}|\\kappa)=\\prod_{k=1}^\\kappa \\pi(\\boldsymbol{\\theta}_k)\\) e \\(\\textbf{p}|\\kappa\\sim\\hbox{Dirichlet}(a_1,\\ldots,a_\\kappa)\\), onde \\[f(\\textbf{p}|\\kappa)\\propto \\prod_{k=1}^\\kappa p_k^{a_k-1}\\] com \\(\\sum_{k=1}^\\kappa p_k=1\\). As condicionais completas para este problema são\n\n\\(\\begin{align}f(\\boldsymbol{\\theta}_k|resto)\\propto \\prod_{i:z_{i,k}=1}f(x_i|\\boldsymbol{\\theta}_k)\\pi(\\boldsymbol{\\theta}_k)\\end{align}\\)\n\\(\\begin{align}f(\\textbf{z}_i|resto)\\propto \\prod_{k=1}^\\kappa \\left[p_kf(x_i|\\boldsymbol{\\theta}_k)\\right]^{z_{i,k}}\\end{align}\\) ou seja, \\(\\textbf{z}_i|rest\\sim\\hbox{Multinomial}(\\tilde{p}_1,\\ldots,\\tilde{p}_\\kappa)\\), onde\n\n\\[\\tilde{p}_k=\\frac{p_kf(x_i|\\boldsymbol{\\theta}_k)}{\\sum_{k=1}^\\kappa p_kf(x_i|\\boldsymbol{\\theta}_k)}\\] * \\(f(\\textbf{p}|resto)\\propto \\prod_{k=1}^\\kappa p_k^{\\sum_{i=1}^n z_{i,k}+a_k-1}\\), ou seja \\(\\textbf{p}|resto\\sim\\hbox{Dirichlet}(a_1+\\sum_{i=1}^n z_{i,1},\\ldots,a_\\kappa+\\sum_{i=1}^n z_{i,\\kappa})\\)\nSe necessário, podemos atrbuir a priori \\[\\pi(\\kappa)=\\frac{1}{M},\\kappa=1,2,\\ldots,M\\] para obter a condicional completa \\[\\pi(\\kappa|resto)=\\frac{\\prod_{i=1}^n\\prod_{k=1}^\\kappa f(x_i|\\boldsymbol{\\theta}_k)^{z_{i,k}}\\pi(\\boldsymbol{\\theta}_k)\\pi(\\textbf{p}|\\kappa)\\pi(\\textbf{z}_i|\\kappa)}{\\sum_{\\kappa=1}^M \\prod_{i=1}^n\\prod_{k=1}^\\kappa f(x_i|\\boldsymbol{\\theta}_k)^{z_{i,k}}\\pi(\\boldsymbol{\\theta}_k)\\pi(\\textbf{p}|\\kappa)\\pi(\\textbf{z}_i|\\kappa)},\\kappa=1,\\ldots,M.\\]\n\n8.3.1 O velho fiel\nO banco de dados faithful mostra a duração e o tempo até a próxima erupção do geiser Velho Fiel, no parque Yellowstone. Abaixo mostramos o diagrama do tempo de espera entre erupções\n\nhist(faithful$waiting)\n\n\n\n\nÉ possível notar classes, uma com tempo e entre erupções menor que 70 com tempo maior. Temos as seguintes estimativas iniciais:\n\n## elementos na classe 1\nx &lt;- faithful$waiting\nz &lt;- x &lt; 70\n# proporção na classe 1\nmean(z)\n\n[1] 0.3786765\n\n# média e desvio padrão na classe 1\nmean( x[z])\n\n[1] 55.15534\n\nsd( x[z])\n\n[1] 6.266558\n\n\n\n## elementos na classe 2\n# proporção na classe 2\nmean(z==F)\n\n[1] 0.6213235\n\n# média e desvio padrão na classe 2\nmean( x[z==F])\n\n[1] 80.49112\n\nsd( x[z==F])\n\n[1] 5.456667\n\n\nVamos considerar que as duas componentes possuem distribuição normal. Para cada componente, teremos as seguintes prioris:\n\\[\\pi(\\mu_i,\\phi_i)=\\frac{\\phi^{1/2}_i}{\\sqrt{2\\pi C}}e^{-\\frac{\\phi_i}{2C}(\\mu_i-m_i)^2}\\frac{b^a}{\\Gamma(a)}\\phi_i^{a-1}e^{b\\phi_i},\\]\n\\[p\\sim\\hbox{Beta}(r,s)\\]\n\\[z_i\\sim\\hbox{Bernoulli}(p)\\]\nO modelo aumentado é \\[f(x_i|\\mu,\\phi,z_{i})=\\left[\\frac{\\phi_1^{1/2}}{\\sqrt{2\\pi}}e^{-\\frac{\\phi_1}{2}(x_i-\\mu_1)}\\right]^{z_i}\\left[\\frac{\\phi_2^{1/2}}{\\sqrt{2\\pi}}e^{-\\frac{\\phi_2}{2}(x_i-\\mu_2)}\\right]^{1-z_i}\\] As condicionais completas são:\n\\[\\begin{align}f(\\mu_1|resto) &\\propto \\exp\\left\\{-\\frac{\\phi_1}{2}\\sum_{i=1}^n z_i(x_i-\\mu_1)^2\\right\\}\\exp\\left\\{-\\frac{\\phi_1}{2C} z_i(\\mu_1-m_1)^2\\right\\}\\\\&\\propto \\exp\\left\\{-\\frac{\\phi_1}{2}\\left(\\sum_{i=1}^n z_i+C^{-1}\\right) \\left(\\mu_1-\\frac{\\sum_{i=1}^{n}x_iz_i+m_1C^{-1}}{\\sum_{i=1}^n z_i+C^{-1}}\\right)^2\\right\\}\\end{align}\\]\n\\[\\begin{align}f(\\mu_2|resto) &\\propto \\exp\\left\\{-\\frac{\\phi_2}{2}\\sum_{i=1}^n (1-z_i)(x_i-\\mu_2)^2\\right\\}\\exp\\left\\{-\\frac{\\phi_2}{2C} (1-z_i)(\\mu_2-m_2)^2\\right\\}\\\\&\\propto \\exp\\left\\{-\\frac{\\phi_2}{2}\\left(\\sum_{i=1}^n (1-z_i)+C^{-1}\\right) \\left(\\mu_2-\\frac{\\sum_{i=1}^{n}x_i(1-z_i)+m_1C^{-1}}{\\sum_{i=1}^n (1-z_i)+C^{-1}}\\right)^2\\right\\}\\end{align}\\]\n\\[\\begin{align}f(\\phi_2|resto)&\\propto \\phi_2^{-\\frac{1}{2}\\sum_{i=1}^{n}z_i}\ne^{-\\frac{\\phi_2}{2}\\sum_{i=1}^n (1-z_i)(x_i-\\mu_2)^2}\\phi^{-1/2}_2e^{-\\frac{\\phi_2}{2}(\\mu_2-m_2)^2}\\phi_2^{a/2-1}e^{-\\phi_2 b/2}\\\\ &\\propto \\phi_2^{\\frac{1}{2}(1+a+\\sum_{i=1}^{n}(1-z_i)-1}e^{-\\frac{\\phi_2}{2}[\\sum_{i=1}^n(1-z_i)(x_i-\\mu_2)^2 +(\\mu_2-m_2)^2 + b]}\\end{align}\\] \\[\\begin{align}f(\\phi_1|resto)&\\propto \\phi^{-\\frac{1}{2}\\sum_{i=1}^{n}z_i}\ne^{-\\frac{\\phi_1}{2}\\sum_{i=1}^n z_i(x_i-\\mu_1)^2}\\phi^{-1/2}e^{-\\frac{\\phi_1}{2}(\\mu_1-m_1)^2}\\phi_1^{a/2-1}e^{-\\phi_1 b/2}\\\\ &\\propto \\phi_1^{\\frac{1}{2}(1+a+\\sum_{i=1}^{n}z_i)-1}e^{-\\frac{\\phi_1}{2}[\\sum_{i=1}^nz_i(x_i-\\mu_1)^2 +(\\mu_1-m_1)^2 + b]}\\end{align}\\]\n\\[\\begin{align}f(p|resto)\\propto \\prod_{i=1}^n p^{z_i}(1-p)^{1-z_i}p^{r-1}(1-p)^{s-1}\\propto p^{r+\\sum_{i=1}^n z_i-1}(1-p)^{s+\\sum_{i=1}^n (1-z_i)-1}\\end{align}\\]\n\\[f(z_i|resto)\\propto\\left[ p\\frac{\\phi_1^{1/2}}{\\sqrt{2\\pi}}e^{-\\frac{\\phi_1}{2}(x_i-\\mu_1)^2}\\right]^{z_i}\\left[ (1-p)\\frac{\\phi_2^{1/2}}{\\sqrt{2\\pi}}e^{-\\frac{\\phi_2}{2}(x_i-\\mu_2)^2}\\right]^{1-z_i}\\]\nAbaixo implementamos o amostrador de Gibbs\n\nB &lt;- 50000\n\n# hiperparmametros\nm1 &lt;- 65\nm2 &lt;- 80\nC &lt;- 1000\nr= 4; s = 6\na = 1; b = .1\n\n# valores iniciais\nz &lt;- x &lt; 70\nphi1 &lt;- 1/36\nphi2 &lt;- 1/25\nmu1 = mu2 =  p = NULL\n\nfor(i in 1:B){\n  # mu dado o resto\n  m1_post &lt;- ( sum(x*z) + m1/C) / ( sum(z) + 1/C )\n  m2_post &lt;- ( sum(x*(1-z)) + m1/C) / ( sum(1-z) + 1/C )\n  s1_post &lt;- 1 / ( ( sum(z) + 1/C )*phi1[i] )\n  s2_post &lt;- 1 / ( ( sum(1-z) + 1/C )*phi2[i] )\n  \n  mu1[i+1] &lt;- rnorm(1, m1_post, sqrt( s1_post) )\n  mu2[i+1] &lt;- rnorm(1, m2_post, sqrt( s2_post) )\n  \n  # phi dado resto\n  phi1[i+1] &lt;- rgamma(1, 1 + a + sum(z), sum( z*(x - mu1[i+1])^2 ) + (mu1[i+1]-m1)^2 + b)\n  phi2[i+1] &lt;- rgamma(1, 1 + a + sum(1-z), sum( (1-z)*(x - mu2[i+1])^2 ) + (mu2[i+1]-m2)^2 + b)\n  \n  # p dado resto\n  p[i+1] &lt;- rbeta(1, r + sum(z), s + sum(1-z) )\n  \n  # z dado resto\n  aux1 &lt;- p[i+1]*dnorm(x,mu1[i+1], 1/sqrt(phi1[i+1]))\n  aux2 &lt;- (1-p[i+1])*dnorm(x,mu2[i+1], 1/sqrt(phi2[i+1]))\n  \n  z &lt;- rbinom(length(x), 1, aux1/( aux1 + aux2))\n}\n# \n\n\nhist(mu1[seq(B/2,B,30)])\n\n\n\nhist(mu2[seq(B/2,B,30)])"
  }
]