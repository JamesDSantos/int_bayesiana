{
  "hash": "3fa8ec2932af30553186c0016b4c1857",
  "result": {
    "engine": "knitr",
    "markdown": "# Regressão logística\n\n## Introdução \n\nO seguinte exemplo, retirado do livro Applied Linear Statistical Models by Kutner, Nachtsheim, Neter, & Li, apresenta o número de insetos mortos após a exposição de certa toxina em diferentes doses.\n\n| Dose | Insetos expostos | Mortes |\n|------|----------|--------|\n| 1    | 250      | 28     |\n| 2    | 250      | 53     |\n| 3    | 250      | 93     |\n| 4    | 250      | 126    |\n| 5    | 250      | 172    |\n| 6    | 250      | 197    |\n\n\nObserve que o aumento da dose implica no aumento do número de mortes. Estamos interessados em modelar a probabildade de um inseto morrer ao ser exposto por certa dose desta toxina. Podemos estimar essa probabilidade através da frequência relativa, que pode ser conferida no gráfico abaixo.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](logistica_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n\nSeja $Y_i=1$ se o $i$-ésimo inseto morreu após a exposição da dose $x_i$ e $Y_i=0$ em caso contrário. Teremos então que $Y_i|x_i\\sim\\hbox{Bernoulli}(p(x_i))$, uma vez que a letalidade depende da dose. Como\n$$E(Y_i|x_i)=p(x_i)$$\na estimação da probabilidade da letalidade da dose é um problema de regressão. Contudo, pode-se perceber que a relação entre $y_i$ e $x_i$ não pode ser linear, uma vez que $p(x)$ está restrito ao intervalo (0,1) para todo valor de $x$. Podemos reparametrizar o problema, de modo que o novo espaço paramétrico pertença a reta. A pametrização usual utiliza  função logit:\n\n$$\\eta=\\hbox{logit}(p)=\\log\\left(\\frac{p}{1-p}\\right),$$\no que implica em\n$$p=\\frac{e^\\eta}{1+e^\\eta}.$$\n\nA principal vantagem desta nova parametrização estão no fato de que, em geral, \n$$\\eta_i = \\beta_0+\\beta_1 x_i=\\underbrace{(1\\;\\;x_i)}_{\\boldsymbol{x}'_i}\\underbrace{\\left(\\begin{array}{c}\\beta_0\\\\\\beta_1 \\end{array}\\right)}_{\\boldsymbol{\\beta}}=\\boldsymbol{x}'_i\\boldsymbol{\\beta}.$$\n\nComo os parâmetros são os mesmos do modelo de regressão linear, podemos utilizar as mesmas priori discutidas anteriormente para este novo modelo.\n\n## O model de regressão logística\n\nSeja $Y_1,\\ldots,Y_n$ uma amostra de variáveis independentes com $Y_i|\\boldsymbol{x}\\sim\\hbox{Bernoulli}(p_i)$ onde \n$$\\hbox{logit}(p_i)=\\boldsymbol{x}'_i\\boldsymbol{\\beta},$$\ne $\\boldsymbol{\\beta}$ e $\\boldsymbol{x}_i$ são vetores de comprimento $k$. A função de verossimilhança para este modelo é dada por\n$$L(\\boldsymbol{\\beta})=\\prod_{i=1}^n p_i^{y_i}(1-p_i)^{1-y_i}$$\n\nComo priori, considere inicalmente que:\n\n$$\\begin{align}\\boldsymbol{\\beta}|\\phi &\\sim\\hbox{Normal}(\\textbf{0}_k,\\phi^{-1}(\\boldsymbol{X}'\\boldsymbol{X})^{-1} )\\\\ \\phi&\\sim \\hbox{Gama}(\\nu/2,b/2) \\end{align}$$\no que implica em \n$$\\boldsymbol{\\beta}\\sim t_{\\nu}(\\textbf{0}_k, \\frac{b}{\\nu}\\left(\\boldsymbol{X}'\\boldsymbol{X})^{-1}\\right)$$\nA posteriori é dada por\n\n$$f(\\boldsymbol{\\beta}|\\boldsymbol{y},\\boldsymbol{x})\\propto L(\\boldsymbol{\\beta})f(\\boldsymbol{\\beta})$$\n\nPodemos então simular desta posteriori através do algoritmo Metropolis, utilizando como proposta a distribuição aproximada do estimador de máxima verossimilhança para $\\boldsymbol{\\beta}$.\n\n<div class ='alert alert-info'>\n**Exemplo**\n\nVamos ajustaro o modelo de regressão logística para os dados da introdução.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(mvtnorm)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: mvtnorm\n```\n\n\n:::\n\n```{.r .cell-code}\n# hperparâmetros\nnu = b = 3\n\n# matriz de regressoras\ndose <- sapply(1:6, function(z) rep(z,250))\ndose <- matrix( dose, ncol = 1)\nX <- cbind(1, dose) \n\n# vetor de respostas\nmortes <- c(23, 53, 93, 126, 172, 197)\ny <- sapply( mortes, function(z) c(rep(1,z),rep(0,250-z) ) )\ny <- matrix(y, ncol = 1)\n\n# obtendo as estimativas de máxima verossimilhança e o informação de Fisher\nmod <- glm( y~X-1, family=binomial( link = 'logit'))\nemv <- mod$coefficients\nmatriz_escala <- (summary(mod))$cov.unscaled\n\n# implementando a função log-posteriori\nSigma <- solve(t(X)%*%X)\nlogPost <- function(beta){\n  mu = X%*%matrix(beta, ncol = 1)\n  p  =  exp(mu)/(1+exp((mu)))\n  log_vero = sum(y*log(p)+(1-y)*log(1-p))\n  log_prio = dmvt(beta, sigma = (b/nu)*Sigma, df = nu)\n  log_vero + log_prio\n}\n\n# simulando da posteriori\nB = 50000\nbeta_sim <- array(NA_real_, c(B+1, length(emv)))\nbeta_sim[1,] <- emv\nfor(i in 1:B){\n  beta_cand <- rmvnorm(1, emv, matriz_escala)\n  alpha = exp(logPost(beta_cand) - logPost(beta_sim[i,]))\n  u = runif(1)\n  ifelse( u <alpha, beta_sim[i+1,] <- beta_cand, beta_sim[i+1,] <- beta_sim[i,])\n}\n\nbeta_post <- beta_sim[ seq(B/2, B, 15), ]\n```\n:::\n\n\n\n\nAs estimativas para $\\boldsymbol{\\beta}$ são \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolMeans(beta_post)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -2.7145147  0.6888578\n```\n\n\n:::\n:::\n\n\n\nO intervalo de credibilidade de 95% para $\\beta_1$, dado abaixo, apresenta evidências de que $\\beta_1>1$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquantile(beta_post[,2], c(.025, .975))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     2.5%     97.5% \n0.6334415 0.7441429 \n```\n\n\n:::\n:::\n\n\n\nAo testat $H:\\beta_1>0$, temos evidências decisivas sobre o efeito positivo no aumento da dosagem na probabilidade de morte.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(beta_post[,2]>0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n:::\n\n\n\n\n\nAbaixo, apresentamos o gráfico do início da seção com a curva \n$$\\hat{p}(x)=\\frac{e^{-2,71+0,689x}}{1+e^{-2,71+0,689x}}$$\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](logistica_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n</div>\n\n\n\n\n## Exercícios\n\n### PIMA revisitado\n\nVimos anteriormente diagnósticas e de saúde de 768 mulheres da tribo Pima, que vivem perto de Phoenix, Arizona, EUA. O objetivo original do estudo era prever o início do diabetes (variável `Outcome`) considerando as seguintes regressoras:\n\n* Glucose: Concentração de glicose no plasma a 2 horas em um teste de tolerância à glicose oral.\n\n* BloodPressure: Pressão diastólica sanguínea (mm Hg).\n\n* SkinThickness: Espessura da dobra da pele do tríceps (mm).\n\n* Insulin: Insulina sérica de 2 horas (mu U/ml).\n\n* BMI: Índice de Massa Corporal (peso em kg / (altura em m)^2).\n\n* DiabetesPedigreeFunction: Função pedigree de diabetes (um histórico familiar).\n\n* Age: Idade (anos).\n\n\nAbaixo, apresentamos novamente como obter o banco de dados.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(gsheet)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: gsheet\n```\n\n\n:::\n\n```{.r .cell-code}\nurl <- 'https://docs.google.com/spreadsheets/d/1TFvnPYCZ9CwUBs8P3FM8OMAxSmDsCktmu6h2k-OR7z8/edit?usp=sharing'\n\ndados <- data.frame( gsheet2tbl(url))\nhead(dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Pregnancies Glucose BloodPressure SkinThickness Insulin  BMI\n1           6     148            72            35       0 33.6\n2           1      85            66            29       0 26.6\n3           8     183            64             0       0 23.3\n4           1      89            66            23      94 28.1\n5           0     137            40            35     168 43.1\n6           5     116            74             0       0 25.6\n  DiabetesPedigreeFunction Age Outcome\n1                  627.000  50       1\n2                  351.000  31       0\n3                  672.000  32       1\n4                  167.000  21       0\n5                    2.288  33       1\n6                  201.000  30       0\n```\n\n\n:::\n:::\n\n\n\n\nAtravés de um modelo de regressão logística, encontre quais são as variaáveis adequadas para o problema e estime a curva logit. ",
    "supporting": [
      "logistica_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}