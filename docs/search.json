[
  {
    "objectID": "poisson.html",
    "href": "poisson.html",
    "title": "7  O modelo Poisson",
    "section": "",
    "text": "7.1 Sobre o modelo\nSeja \\(N(t)\\) o número de ocorrências observadas no intervalo de tempo \\([0,t]\\) (considere que \\(N(0)=0\\)). Note que o número de eventos no intervalo \\((s,t]\\) é dado por \\(N(t)-N(s)\\).\nDizemos que \\(N(t)\\) tem incrementos independentes se, para quaisquer intervalos disjuntos \\((s_0,t_0]\\) e \\((s_1,t_1]\\), as contagens \\(N(t_0)-N(s_0)\\) e \\(N(t_1)-N(s_1)\\) são independentes.\n\\(N(t)\\) é denominado Processo de Poisson quando ele possui incrementos indepentes e, para qualquer intervalo \\((s,t]\\),\n\\[P(N(t)-N(s)=x)=\\frac{e^{-\\lambda(t-s)[\\lambda(t-s)]^x}}{x!},\\] onde \\(x=0,1,\\ldots\\) e \\(\\lambda&gt;0\\). Isto implica que \\[E(N(t))=\\lambda t,\\] ou seja, o número esperado de ocorrências até o tempo \\(t\\) é diretamente proporcional à \\(t\\) e \\(\\lambda\\) representa a taxa de crescimento. Para este processo, é verdade que \\[\\lim_{\\delta\\rightarrow 0}P(N(t+\\delta)-N(t)&gt;1)=0,\\] ou seja, não é possível observar duas ou mais ocorrências simultaneamente.\nEm geral, os experimentos são desenhados para registrar contagens em intervalos regulares e disjuntos de tempo, como semanas ou anos. Considere que tais intervalos são \\([0,s_1],(s_1,s_2],\\ldots,(s_{n-1},t]\\) e seja \\(c\\) o comprimento destes intervalos. Em geral, os dados são apresentados como contagens dentro destes intevalos, gerando as seguintes variáveis:",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  },
  {
    "objectID": "poisson.html#sobre-o-modelo",
    "href": "poisson.html#sobre-o-modelo",
    "title": "7  O modelo Poisson",
    "section": "",
    "text": "\\(X_1=N(s_1)\\sim\\hbox{Poisson}(\\lambda c)\\)\n\\(X_2=N(s_2)-N(s_1)\\sim\\hbox{Poisson}(\\lambda c)\\)\n\\(\\cdots\\)\n\\(X_n=N(t)-N(s_{n-1})\\sim\\hbox{Poisson}(\\lambda c)\\) ou seja, \\(X_1,\\ldots,X_n\\) são uma amostra aleatória do modelo Poisson(\\(\\lambda c\\)). Na prática, \\(c=1\\) por ser a unidade de medida de tempo associada ao experimento (uma semana, um ano, etc).\n\n\n7.1.1 Tempo de chegada e de espera\nPara um processo de Poisson \\(N(t)\\), definimos o tempo de chegada como o tempo entre duas observações consecutivas. Denotaremos o tempo de chegadas entre a \\(i\\)-ésima e a \\((i-1)\\)- ésima ocorrência por \\(T_i\\).\nÉ possível mostrar que \\(T_i\\) é independente de \\(T_j\\), para \\(i\\neq j\\) e que \\(T_i\\sim\\hbox{Exponencial}(\\lambda)\\). Por isso, para uma amostra aleatória de um modelo Exponencial(\\(\\lambda\\)), o parâmetro \\(\\lambda\\) é denominado taxa.\nDefinimos por tempo de espera da ocorrência \\(n\\) como o tempo transcorrido desde o início do processo até a ocorrência do \\(n\\)-ésimo evento. Este tempo de espera é denotado por \\(S_n\\). Exsitem dois resultados importantes relacionados ao tempo de espera:\n\n\\(S_n=T_1+\\cdots+T_n\\) tem distribuição Gama(\\(n,\\lambda\\))\nDado que \\(N(t)=n\\), os tempos de espera dos eventos estão uniformemente distribuídos dentro do intervalo \\((0,t)\\).\n\n\n\n7.1.2 Ocorrências de diversas classes\nSuponha que as ocorrências observadas podem ser classificadas em \\(k\\) categorias. Suponha que qualquer ocorrência tem probabilidade \\(p_j\\) de pertencer a categoria \\(j\\). Então\n\nO número de ocorrências da classe \\(j\\) é um processo de Poisson com taxa \\(\\lambda p_j\\)\nO número de ocorrências da classe \\(j\\) é independente do número de ocorrências da classe \\(i\\), com \\(i\\neq j\\)\n\n\n\n7.1.3 O processo de Poisson Espacial\nSeja \\(N(A)\\) o número de ocorrências observadas em uma região de área \\(A\\). \\(N(A)\\) é denominado Processo de Poisson Espacial quando \\(N(A)\\sim\\hbox{Poisson}(\\lambda A)\\) e, para duas regiões distintas de áreas \\(B\\) e \\(C\\), \\(N(B)\\) e \\(N(C)\\) são independentes.\nNote que, para um Processo de Poisson Espaical, dado \\(N(A)=n\\) as \\(n\\) ocorrências estão uniformemente distribuídas dentro da região \\(A\\)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  },
  {
    "objectID": "poisson.html#verossimilhança-e-priori-conjugada",
    "href": "poisson.html#verossimilhança-e-priori-conjugada",
    "title": "7  O modelo Poisson",
    "section": "7.2 Verossimilhança e priori conjugada",
    "text": "7.2 Verossimilhança e priori conjugada\nSeja \\(X_1,\\ldots,X_n\\) uma amostra aleatória do modelo Poisson\\((\\lambda)\\). A verossimilhança deste modelo é dada por\n\\[L(\\theta)=\\frac{e^{-n\\theta}\\theta^{\\sum_{i=1}^{n}x_i}}{\\prod_{i=1}^{n}x_i!}\\propto \\theta^{\\sum_{i=1}^n x_i}e^{-n\\theta}.\\] O modelo Poisson pertence à família exponencial e sua priori conjugada é \\(\\theta\\sim\\hbox{Gama}(r,s)\\) e a posteriori é \\(\\hbox{Gama}(r+\\sum_{i=1}^n x_i, s+n)\\), conforme já discutido na Introdução. Os hiperparâmetros \\(r\\) e \\(s\\) podem ser interpretados como o total da contagem e o tamanho da amostra a priori.\nA média da posteriori é \\[E(\\theta|\\mathbf{x})=\\frac{\\sum_{i=1}^{n}x_i+r}{n+s}=\\frac{n}{n+s}\\bar{x}+\\frac{s}{n+s}E(\\theta),\\] onde fica claro que este estimador é uma média ponderada das informações provenientes das duas fontes de informação (sendo \\(\\bar{x}\\) a estimativa de máxima verossimilhança e \\(E(\\theta)\\) a média a priori).\nSe \\(n\\gg s\\), então a média a posteriori dará maior peso para a informação dos dados.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  },
  {
    "objectID": "poisson.html#preditiva-a-posteriori",
    "href": "poisson.html#preditiva-a-posteriori",
    "title": "7  O modelo Poisson",
    "section": "7.3 Preditiva a posteriori",
    "text": "7.3 Preditiva a posteriori\nA inferência bayesiana é baseada em duas fontes de informação: verossimilhança e priori. Já discutimos que, na maioria dos casos, estamos interessados em deixar a verossimilhança ter mais peso na posteriori. Agora, vamos discutir como verificar se a verossimilhança é adequada ao problema.\nSeja \\(\\boldsymbol{x}=\\{x_1,\\ldots,x_n\\}\\) a amostra observada e \\(f(\\theta|\\boldsymbol{x})\\) a posteriori obtida. Supondo que a informação sobre os parâmetros foi capturada de forma adequada, é de se esperar que uma nova observação \\(x^*\\) se comporte de modo semelhante a amostra observada. Podemos então obter a seguinte distribuição, denominada preditiva a posteriori:\n\\[\\begin{align}f(x^*|\\boldsymbol{x})=\\int f(x^*|\\theta)f(\\theta|\\boldsymbol{x})d\\theta.\\end{align}\\]\nPodemos comparar as características preditiva a posteriori com estatísticas livres de modelos como box-plots, histogramas, etc.\n\nPreditiva a posteriori para o modelo Poisson\nPara o modelo Poisson(\\(\\lambda\\)) e para a posteriori Gama\\((r_1,s_1)\\), onde \\(r_1=r+\\sum_{i=1}^n x_i\\) e \\(s_1=n+s\\), \\[\\begin{align}\nf(x^*|\\boldsymbol{x})&=\\int_0^\\infty f(x^*|\\lambda)f(\\lambda|\\boldsymbol{x})d\\lambda\\\\\n&=\\int_0^\\infty\\frac{e^{-\\lambda}\\lambda^{x^*}}{x^*!}\\frac{s_1^{r_1}}{\\Gamma(r_1)}\\lambda^{r_1-1}e^{-s_1\\lambda}d\\lambda\\\\\n&=\\frac{s_1^{r_1}}{\\Gamma(r_1)x^*!}\\int_0^\\infty \\lambda^{r_1+x^*-1}e^{-\\lambda(s_1+1)}d\\lambda\\\\\n&=\\frac{\\Gamma(r_1+x^*)}{\\Gamma(r_1)x^*!}\\left(\\frac{s_1}{1+s_1}\\right)^{r_1}\\left(1 - \\frac{s_1}{s_1+1}\\right)^{x^*}\n\\end{align}\\] ou seja, a preditiva a posteriori tem distribuição\n\\[\\hbox{Binomial Negativa}\\left(r_1,\\frac{s_1}{1+s_1}\\right).\\]\n\n\nExample 7.1 A Blitz e os Bombardeios de Londres\nDurante a Segunda Guerra Mundial, Londres sofreu intensos bombardeios aéreos pela Alemanha Nazista (conhecido como “Blitz”). Estatísticos analisaram a distribuição das quedas de 537 bombas pela cidade para procurar padrões.\nUma questão chave era se as bombas caíam aleatoriamente ou se havia algum padrão de alvo. Se as quedas de bombas fossem aleatórias, elas deveriam seguir uma distribuição de Poisson. Londres foi dividida em uma grade de com 576 setores de áreas iguais. O número de quedas de bombas em cada setor foi registrado.\n\nQuedas de bombas em Londres durante o Blitz.\n\n\n\n\n\n\nNúmero de bombas\nNúmero de setores com x bombas\n\n\n\n\n0\n229\n\n\n1\n211\n\n\n2\n93\n\n\n3\n35\n\n\n4\n7\n\n\n5 ou mais\n1\n\n\n\nSupondo que os dados seguem uma distribuição Poisson(\\(\\lambda\\)), teremos \\[L(\\lambda)\\propto e^{-576\\lambda}\\lambda^{537}.\\] Considerando a priori \\(\\lambda\\sim\\hbox{Gama}(1,1)\\), teremos a posteriori Gama\\((538,577)\\). A preditiva a posteriori para problema é\n\\[\\hbox{Binomial Negativa}(538,.9982).\\]\nObserve que podemos estimar a frequência relativa dos eventos da tabela. Podemos comparar esses resultados com o que seria esperado da preditiva. O resultado é dado a seguir.\n\nr1 = 538\np = 577/578\n`Número de bombas no setor` &lt;- c(0,1,2,3,4,'&gt;4')\n`Frequência relativa` &lt;- c(229,211,93,35,7,1)/576\n`Preditiva a posteriori` &lt;- c(dnbinom( 0:4, size=r1, prob = p), 1-pnbinom(4,size=r1,prob=p))\n\ndt &lt;- data.frame(`Número de bombas no setor`, `Frequência relativa`,`Preditiva a posteriori`)\n\nprint(dt)\n\n  Número.de.bombas.no.setor Frequência.relativa Preditiva.a.posteriori\n1                         0         0.397569444            0.393922155\n2                         1         0.366319444            0.366661107\n3                         2         0.161458333            0.170960499\n4                         3         0.060763889            0.053240294\n5                         4         0.012152778            0.012458045\n6                        &gt;4         0.001736111            0.002757901\n\n\nA proximidade entre as frequências relativas e os resultados obtidos através da preditiva a posteriori dão evidências de que o modelo Poisson é adequado, ou ainda, que as bombas foram lançadas ao acaso.\n\n\nNúmero de suicídios revisitado\nNa introdução, apresentamos o número de suicídios no Amazonas para os anos 2021, 2022 e 2023. Os dados podem ser vistos abaixo.\n\nno_suicidios &lt;- c(19, 26, 30, 28, 25, 23,23, 21,\n22, 27, 31, 22, 23, 21, 29, 27, 26, 23,\n36, 27, 24, 21, 18, 22, 34, 27, 26, 26, 34,\n22, 27, 25, 32, 36, 28, 22 )\n\nAnalisamos estes dados e obtivemos a posteriori Gama(953.8, 37.1) para a taxa. A distribuição da preditiva a posteriori é Binomial Negativa\\((953.8\\;,\\;0,9737)\\).\nA figura abaixo apresenta a função de distribuição empírica dos dados comparada com a função de distribuição da preditiva a posteriori. A aproximação é razoável o suficiente para aceitarmos o modelo proposto como válido.\n\nplot( ecdf(no_suicidios), main = '', ylab='Função de distribuição', xlab=expression(x))\ncurve(pnbinom(x,sum(no_suicidios)+1,37/38), add=T, lwd = 2, col = 'tomato')\nlegend('bottomright', c('Empírica','Preditia a posteriori'), col=c(1,'tomato'), bty='n')\n\n\n\n\n\n\n\n\n\n7.4 O modelo Poisson para taxas\n\n7.4.1 Modelo de taxa única\nA taxa é o quociente entre o número de casos de um evento em determinado intervalo de tempo e a população em risco, definida em um espaço e no mesmo intervalo de tempo “pessoas-tempo”. Note que, pela definição, a taxa é uma estatística.\nSeja \\(N\\) o tamanho da população no espaço/tempo e seja \\(y\\) o número de casos do evento de interesse. Então,\n\\[\\hbox{taxa} = \\frac{y}{N}\\]\nContudo, como \\(N\\) tende a ser muito maior que \\(y\\), é comum reportar a taxa vezes \\(10^k\\), para algum \\(k&gt;0\\). O mais comum é ter \\(k=5\\) e esta convenção é adotada aqui.\n\nCrime de estupro no país Segundo o Anuário de Segurança Pública 2023, em 2022 houveram 74.930 casos de estupro. Considerando uma população de 208,2 milhões de habitantes, a taxa de estupro para aquele ano foi de \\[\\frac{68.885}{208.200.000}\\times 10^{-5}=35,98\\] casos por pessoa-ano.\nPortanto, temos uma taxa de 35,98 casos para cada 100.000 habitantes.\n\nAgora, considere que \\(\\lambda\\) é o parâmetro taxa. Então,\n\\[\\hat{\\lambda}=\\frac{y}{N}\\] é a estimativa para \\(\\lambda\\). Como \\(y\\) é uma contagem, é razoável supor que \\[\\lambda =\\frac{1}{N}E(Y|\\lambda),\\] e um modelo com essa parametrização seria \\(y|\\lambda\\sim\\hbox{Poisson}(\\lambda N)\\). Observe que, na prática \\(N\\) já está dividido por \\(10^5\\).\n\nCrime de estupro no país (cont.) Seja \\(y\\) o número de crimes de estupro dados no exemplo anterior. Seja \\(n=212.700.000/10^5=2082\\) a população do país dividida por \\(10^5\\). Considerando o modelo \\(y|\\lambda\\hbox{Poisson}(2082\\lambda)\\) temos a seguinte verossimilhança para \\(\\lambda\\):\n\\[L(\\lambda)\\propto \\lambda^{74930}e^{-2082\\lambda  }\\] Utilizando a priori Gama(1,1) (que representa um caso para cada 100.000 habitantes), teremos a posteriori Gama(74931,2083) e a estimativa \\[E(\\lambda|y)=\\frac{74931}{2083}=35,97.\\] ou seja, 35,97 casos a cada 100.000 habitantes.\n\nAgora, considere que a população está particionada em \\(m\\) localidades. Sejam \\(N_i\\) e \\(y_i\\) a população da localidade \\(i\\) e seu respectivo número de casos observados. Suponha ainda que a taxa \\(\\lambda\\) é comum para a população e que \\(y_i\\) e \\(y_j\\) são independentes dado \\(\\lambda\\). Assumindo a distribuição Poisson, teremos\n\\[L(\\lambda)=\\prod_{i=1}^m\\frac{e^{-\\lambda n_i}(\\lambda N_i)^{y_i}}{y_i!}\\varpropto \\lambda^{\\sum_{i=1}^m y_i}e^{-\\lambda \\sum_{i=1}^m N_i}=\\lambda^{\\sum_{i=1}^n y_i}e^{-\\lambda N},\\] onde \\(N=\\sum_{i=1}^m N_i\\) é o tamanho da população. Como a verossimilhança pertence à família exponencial, temos que o modelo Gama\\((r,s)\\) é conjugado gerando a posteriori\n\\[\\lambda|\\mathbf{y}\\sim\\hbox{Gama}\\left(\\sum_{i=1}^{m}y_i+r,N+s\\right)\\equiv \\hbox{Gamma}(r_1,s_1).\\] Observe que essa posteriori é identica a obtida no exemplo anterior, quando consideramos o número de casos na população.\nConsidere agora um novo valor observado da localidade \\(i\\). Sua preditiva a posteriori é dada por\n\\[\\begin{align}\nf(y^*_i|\\boldsymbol{y})&=\\int_0^\\infty f(y^*_i|\\lambda)f(\\lambda|\\boldsymbol{y})d\\lambda\\\\\n&\\int_0^\\infty \\frac{e^{-\\lambda N_i}(\\lambda N_i)^{y_i^*}}{y_i^*!}\\frac{s_1^{r_1}}{\\Gamma(r_1)}\\lambda^{r_1-1}e^{-\\lambda s_1}d\\lambda\\\\\n&=\\frac{\\Gamma(r_1+y_i^*)}{y_i^*!\\Gamma(r_1)}\\left(\\frac{s_i}{N_i+s_i}\\right)^{r_1}\\left(1-\\frac{s_i}{N_i+s_i}\\right)^{y_i^*},\n\\end{align}\\] ou seja, \\[y_i^*|\\boldsymbol{y}\\sim\\text{Binomial Negativa}\\left(r_1,\\frac{s_1}{N_i+s_1}\\right),\\] cujo valor esperado é \\[E(y_i^*|\\boldsymbol{y})=\\frac{r_1}{s_1}N_i.\\]\nDeste modo, a taxa da preditiva a posteriori é dada por \\[E(\\frac{y_i^*}{N_i}|\\boldsymbol{y})=\\frac{r_1}{s_1}\\] e podemos comparar o ajuste considerando a distribuição de \\(y^*_i/N_i\\) com \\(y_i/N_i\\).\n\nCrime de estupro no país (cont.) Os dados deste exemplo estão no banco abaixo.\n\nrequire(gsheet)\n\nCarregando pacotes exigidos: gsheet\n\nurl &lt;- 'https://docs.google.com/spreadsheets/d/11Sr8mqilWCe6Dj8TO6PgTYpJT292vbon1XnB0Co1Trc/edit?usp=sharing'\n\ndados &lt;- data.frame(gsheet2tbl(url))\n\nNo encoding supplied: defaulting to UTF-8.\n\nprint(dados)\n\n   Unidade.Federativa..UF. População.Estimada..2023. Crimes.de.estupro\n1                     Acre                    830018               745\n2                  Alagoas                   3127511              1040\n3                    Amapá                    733759               628\n4                 Amazonas                   4145525               836\n5                    Bahia                  14659023              4558\n6                    Ceará                   9187078              1897\n7         Distrito Federal                   2817068               754\n8           Espírito Santo                   4018650              1736\n9                    Goiás                   7206589              3667\n10                Maranhão                   6775152              2273\n11             Mato Grosso                   3784239              1889\n12      Mato Grosso do Sul                   2756700              2191\n13            Minas Gerais                  20812060              4491\n14                    Pará                   8442765              4557\n15                 Paraíba                   4039277               546\n16                  Paraná                  11835799              6648\n17              Pernambuco                   9496294              2705\n18                   Piauí                   3280062              1241\n19          Rio de Janeiro                  16615526              5627\n20     Rio Grande do Norte                   3302970               881\n21       Rio Grande do Sul                  11088065              5193\n22                Rondônia                   1616379              1027\n23                 Roraima                    636303               726\n24          Santa Catarina                   7762154              4541\n25               São Paulo                  45533984             12615\n26                 Sergipe                   2240560               885\n27               Tocantins                   1496880              1033\n\n\nUtilizando a posteriori Gama(74931,2083), teremos que \\[y_i^*|\\hbox{dados}\\sim\\hbox{Binomial Negativa}\\left(74931,\\frac{2083}{N_i+2083}\\right).\\]\nPodemos construir intervalos de 95% (de predição) para \\(y^*_i\\) utilizando os quantis da preditiva a posteriori, ou seja, encontrando \\(q_1\\) e \\(q_2\\) tais que \\[\\begin{align}\nP(Y_i^*\\leq q_1|\\boldsymbol{y})&=0,025\\\\\nP(Y_i^*\\leq q_2|\\boldsymbol{y})&=0,975.\n\\end{align}\n\\]\nObserve ainda que \\[0,95\\approx P(q_1\\leq Y_i^*\\leq q_2|\\boldsymbol{y})=P\\left(\\frac{q_1}{N_i}\\leq \\frac{Y_i^*}{N_i}\\leq \\frac{q_2}{N_i}|\\boldsymbol{y}\\right),\\] o que implica que \\((q_1,q_2)/N_i\\) é um intervalo de predição de 95% para taxa esperada. Abaixo construímos estes intervalos e contrastamos com a taxa observada.\n\n# taxas observadas\nN &lt;- unlist(dados[,2]/100000)\ntaxas &lt;- unlist(dados[,3]/N)\n\n# posteriori\nr1 = 74931\ns1 = 2083\n\n# limites do intervalo da preditiva a posteriori\nlim_inf &lt;- qnbinom(.025, size = r1, prob = s1/(N+s1))\nlim_sup &lt;- qnbinom(.975, size = r1, prob = s1/(N+s1))\n\n# gráfico\ncores = c('red','green4','red',rep('orange',4),'red','red','green4',\n          'red','red',rep(c('orange','red'),2), 'orange','green4','green4','orange',rep('red',4),'orange','green4','red')\nplot.new()\nplot.window( xlim = c(-70,120), ylim=c(0,27))\nsegments(lim_inf/N,1:27,lim_sup/N,1:27, lwd = 2)\ntext(-70,1:27, unlist(dados[,1]), adj =0 ,col=cores)\npoints(taxas, 1:27, pch = 22, cex =.9, bg = cores)\naxis(1,at = seq(0,120,20))\n\n\n\n\n\n\n\n\nObserve que o modelo de considera uma taxa única para o país se ajusta bem para os estados Alagoas, Maranhão, Piauí, Rio de Janeiro e Sergipe. Unidades da Federação como Amazonas, Bahia, Ceará, Distrito Federal, Minas Gerais, Pernambuco, Rio Grande do Norte e São Paulo, possuem taxas menores do que as preditas. Os demais estados possuem taxas maiores do que as preditas.\n\n\n\n7.4.2 Modelo com uma taxas por localidade\nO último exemplo da seção anterior mostra que o modelo com taxa única pode ser falho. Existem algumas explicações para este fenômeno, como:\n\nO evento observado não depende apenas do tamanho da população. O crime de estupro, por exemplo, depende de variáveis como vunerabilidade social e aparelhamento do estado para o acolhimento das vítimas.\nO evento observado pode ser raro. Eventos raros são mais difíceis de serem observados em populações menores, o que causa distorções.\n\nPodemos tentar mitigar os efeitos acima considerando um modelo no qual cada região possui sua própria taxa, i.e.\n\\[y_i|\\lambda_i\\sim\\hbox{Poisson}(\\lambda_i N_i).\\] Considerando a priori \\(\\lambda_i\\sim\\hbox{Gama}(r,s)\\), teremos\n\\[\\begin{align}\n\\lambda_i| \\hbox{dados} & \\sim \\hbox{Gama}(r+y_i,s+N_i)\\\\\ny^*_i|\\hbox{Dados}&\\sim\\hbox{Binomial Negativa}\\left(r+y_i,\\frac{s}{s+N_i}\\right)\n\\end{align}\\]\nObserve que mesmo que cada região tenha a sua própria taxa, a informação a priori é a mesma para todas elas. Deste modo, é importante que a priori reflita as várias possibilidades de taxas.\n\nCrime de estupro no país (cont.) Considere que as taxas para cada unidade da federação são independentes e identicamente distribuídas. Abaixo apresentamos a densidade estimada via método do núcleo para as taxas.\n\nplot(density(taxas))\ncurve(dgamma(x,100,.5),add = T)\n\n\n\n\n\n\n\n\nVimos na Introdução que uma priori Gama\\((r,s)\\) pode ser elicitada utilizando as seguintes fórmulas:\n\\[\\begin{align}a&=\\left(\\frac{\\hbox{média}}{desvio}\\right)^2\\\\\nb=\\frac{a}{\\hbox{média}}\\end{align}\\]\nFazendo os cálculos abaixo\n\nmedia = mean(taxas)\ndesvio = sd(taxas)\nr = (media/desvio)^2\ns = r/media\nr;s\n\n[1] 3.608031\n\n\n[1] 0.07758706\n\n\nA próxima figura reapresenta a densidade estimada em conjunto com a densidade Gama(3,6;,;0,07)\n\nplot(density(taxas))\ncurve(dgamma(x,3.6,.07),add = T, lwd = 2, col ='tomato')\n\n\n\n\n\n\n\n\nVamos utilizar a priori \\(\\lambda_i\\sim\\hbox{Gama}(3,6\\;,\\;0,07)\\) para analizar este banco de dados, agora com múltiplas taxas.\n\n# hiperparametros\nr = 3.6\ns = .07\n\n# posterioris\nr1 = unlist(dados[,3])+r\ns1 = N + s\n\n# limites do intervalo da preditiva a posteriori\nlim_inf &lt;- qnbinom(.025, size = r1, prob = s1/(N+s1))\nlim_sup &lt;- qnbinom(.975, size = r1, prob = s1/(N+s1))\n\n# gráfico\ncores = c('red','green4','red',rep('orange',4),'red','red','green4',\n          'red','red',rep(c('orange','red'),2), 'orange','green4','green4','orange',rep('red',4),'orange','green4','red')\nplot.new()\nplot.window( xlim = c(-70,120), ylim=c(0,27))\nsegments(lim_inf/N,1:27,lim_sup/N,1:27, lwd = 2)\ntext(-70,1:27, unlist(dados[,1]), adj =0 ,col=cores)\npoints(taxas, 1:27, pch = 22, cex =.9, bg = cores)\naxis(1, at=seq(0,120,20))\n\n\n\n\n\n\n\n\nAs múltiplas taxas apresentam um cenário mais honesto, acomodando cada estado a sua própria realidade. Abaixo, apresentamos um mapa com a taxa estimada.\n\n# Carregar as bibliotecas necessárias\nlibrary(leaflet)\nlibrary(geobr)\n\nCarregando namespace exigido: sf\n\n# Obter os dados geográficos das Unidades da Federação do Brasil usando geobr\nbrasil_uf &lt;- read_state() # Ou o ano mais recente disponível\n\nUsing year/date 2010\n\n# colocar os estados em ordem alfabética\nbrasil_uf &lt;- brasil_uf[order(brasil_uf$name_state), ]\n\n# adicionar as taxas\nbrasil_uf$taxa &lt;- r1/s1\n\n# Definir uma paleta de cores com base nos valores das taxas\npal &lt;- colorNumeric(palette = \"viridis\", domain = brasil_uf$taxa)\n\n# Criar o mapa leaflet\nmapa_leaflet &lt;- leaflet(brasil_uf) %&gt;%\n  setView(lng = -55, lat = -15, zoom = 3) %&gt;% # Centralizar o mapa no Brasil\n  addTiles() %&gt;% # Adicionar camadas de mapa base (OpenStreetMap por padrão)\n  addPolygons(\n    fillColor = ~pal(taxa),\n    weight = 1,\n    color = \"#000000\",\n    fillOpacity = 0.7,\n    label = ~paste0(name_state, \": \", round(taxa, 2)), # Adicionar rótulos ao passar o mouse\n    highlightOptions = highlightOptions(color = \"white\", weight = 2, bringToFront = TRUE)\n  ) %&gt;%\n  addLegend(pal = pal, values = ~taxa, title = \"Taxa\", opacity = 1)\n\nWarning: sf layer has inconsistent datum (+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs).\nNeed '+proj=longlat +datum=WGS84'\n\n# Exibir o mapa (opcional, se você estiver em um ambiente interativo)\nmapa_leaflet\n\n\n\n\n\n\n\n\n7.4.3 Análise de agrupamentos para taxas\nAté o momento estudamos dois exemplos extremos:\n\nUm modelo com uma única taxa por localidade\nUm modelo com uma taxa por localidade\n\nUm modo útil para deicidir qual abordagem é a mais interessante é o uso de um critério de informação. Recordemos que tais critério são escritos como\n\\[-2\\log L(\\hat{\\theta})+2k,\\] onde \\(L(\\theta)\\) é a função de verossimilhança, \\(\\hat{\\theta}\\) é uma estimativa para \\(\\theta\\) e \\(k\\) é uma penalidade relacionada ao número de parâmetros do modelo. Por causa do sinal negativo em \\(L(.)\\), temos que o modelo preferível é aquele com menor valor do critério.\nEm inferência bayesiana é comum o uso do Critério de Informação de Desvio (DIC), onde \\(\\hat{\\theta}=E(\\theta|\\boldsymbol{x})\\) e \\[k=\\frac{1}{2}Var_{\\theta|\\boldsymbol{x}}(\\log L(\\theta)).\\]\nObserve que o cálculo direto de \\(k\\) não é trivial. Entretanto, o DIC pode ser facilmente obtido via o Método de Monte Carlo.\n\nAlgoritmo: Calculando o DIC via Monte Carlo\n\nSimule \\(\\theta_1,\\ldots,\\theta_B\\) da distribuição a posteriori de \\(\\theta\\).\nEstime \\(E(\\theta|\\boldsymbol{x})\\) por \\[\\hat{\\theta}=\\frac{1}{B}\\sum_{j=1}^B \\theta_j\\]\nFaça \\(v_j=-2\\log L(\\theta_j)\\). Estime \\(k\\) por \\[k=\\frac{1}{2B}\\sum_{j=1}^B(v_j-\\bar{v})^2\\]\nCalcule o DIC:\n\n\\[DIC=-2\\log L(\\hat{\\theta})+2k.\\]\n\n\nComparando os dois modelos para as taxas\nNo começo desta seção, estudamo a taxa de crimes de estupro no Brasil, considerando uma única taxa \\(\\lambda\\) comum a todas as unidades da federação. Encontramos a posteriori \\(\\lambda\\sim\\hbox{Gama}(74931,2083)\\). O DIC para este modelo é\n\nB = 10000 # número de simulações\nlambda &lt;- rgamma( B, 74931, 2083) # simulações da posteriori\n\n# média a posteriori\nlambda_chapeu &lt;- mean(lambda)\n\n# calculo de k\nvj &lt;- sapply( lambda, function(l) -2*sum(dpois( dados[,3], l*N, log = T)))\nk &lt;- .5*var(vj)\n\nDIC0 &lt;- -2*sum( dpois(dados[,3], lambda_chapeu*N, log = T) ) +2*k\nDIC0\n\n[1] 11771.55\n\n\nPosteriormente, criamos um modelo com uma taxa por unidade da federação. Para a \\(i\\)ésima unidade, a posteriori da taxa foi dada ´por \\(\\lambda_i\\sim\\hbox{Gama}(y_i+3,6\\;\\;,\\;\\;N_i+0,07)\\). O DIC para este modelo é\n\nB = 10000 # número de simulações\n# hiperparâmetros comuns\nr = 3.6\ns = .07\n\n# simulações da posteriori\nlambda &lt;- sapply(1:B, function(x) rgamma(27, dados[,3]+3.6, N+.07) )\n\n# média a posteriori para cada taxa\nlambda_chapeu &lt;- rowMeans(lambda)\n\n# calculo de k\nvj &lt;- apply( lambda, 2, function(l) -2*sum(dpois( dados[,3], l*N, log = T)))\nk &lt;- .5*var(vj)\n\nDICtodos &lt;- -2*sum( dpois(dados[,3], lambda_chapeu*N, log = T) ) +2*k\nDICtodos\n\n[1] 307.3943\n\n\nObserve que o modelo com uma taxa por unidade da federação possui o menor valor do DIC, sendo assim o mais parcimonioso entre os dois.\n\nSeja \\(S=\\{1,\\ldots,m\\}\\) o conjunto das \\(m\\) localidades. Suponha que é razoável particionar \\(S\\) e \\(k\\) grupos. Por último, considere que todas as localidades dentro de uma partição compartilham a mesma taxa, ou seja, para \\(j\\) dentro da partição \\(S_t\\), tem-se que \\(y_i|\\lambda_t\\sim\\hbox{Poisson}(\\lambda_tN_i)\\), onde \\(\\lambda_t\\sim\\hbox{Gama}(r_t,s_t)\\). O desafio aqui é determinar se a localidade pertence à partição \\(S_t\\).\nConsidere que a localidade \\(i\\) pertence à partição \\(t\\). Defina o vetor coluna \\(z_i\\), de comprimento de comprimento \\(k\\), composto de zeros exceto na coordenada \\(t\\), que vale 1. Defina \\(z_{i,s}\\) como a \\(s\\)-ésima coordenada do vetor \\(z_i\\). Então\n\\[\\prod_{j=1}^k \\lambda_j^{z_{i,j}}=\\lambda_t=\\sum_{j=1}^k \\lambda_j z_{i,j}.\\] Deste modo, temos que \\(y_i|z_i,\\lambda\\sim\\hbox{Poisson}(\\prod_{j=1}^k\\lambda_j^{z_{i,j}} N_i)\\). e a função de verossimilhança é dada por\n\\[L(\\lambda,z)=\\prod_{i=1}^m \\frac{e^{-\\sum_{j=1}^k\\lambda_jz_{i,j}N_i}[\\prod_{j=1}^k \\lambda_j^{z_{i,j}} N_i]^{y_i}}{y_i!}\\propto \\prod_{i=1}^m \\left[\\prod_{j=1}^ke^{-\\lambda_jz_{i,j}N_i}\\right]\\left[\\prod_{j=1}^k \\lambda_j^{z_{i,j}} N_i\\right]^{y_i}=\\prod_{j=1}^k e^{-\\lambda_j\\sum_{i=1}^m z_{i,j}N_i}\\lambda_j^{\\sum_{i=1}^m z_{i,j}y_i}\\] Observe que \\(z_j\\) é desconhecido e vamos tratá-lo como parâmetro. Pela sua natureza, pode-se pensar em utilizar a priori \\(z_j\\sim\\hbox{Bernoulli Multivariada}(p_1,\\ldots,p_k)\\).\nVamos assumir que a priori de \\(z_1,\\ldots,z_m\\) é independente da priori \\(\\lambda_1,\\ldots,\\lambda_k\\).\nPara determinar a posteriori de \\((\\lambda,z)\\), observe que\n\\[\\begin{align}f(\\lambda,z|\\boldsymbol{y})&\\propto L(\\lambda,z)f(\\lambda)f(z)\\\\&\\propto\\prod_{j=1}^k e^{-\\lambda_j\\sum_{i=1}^m z_{i,j}N_i}\\lambda_j^{\\sum_{i=1}^m z_{i,j}y_i}\\prod_{j=1}^k \\lambda_j^{r_j-1}e^{-\\lambda_js_j}\\prod_{i=1}^m \\prod_{j=1}^k p_j^{z_{i,j}}\\end{align}\\] Note que \\[f(\\lambda|z,\\boldsymbol{y})\\]\n\\(z_i\\sim\\hbox{Bernoulli Multivariada}(p_1,\\ldots,p_k)\\)\n\n\n\n7.5 Exercícios\n\n7.5.1 Mortes por coice de cavalo\nLadislaus Bortkiewicz é o responsável pela popularização da distribuição Poisson. Em seu livro intitulado A Lei dos Pequenos Números, é apresentado um conjunto de dados no qual foi rastreado o número de mortes por coice de cavalo em 14 corpos do exército prussiano ao longo de 20 anos (de 1875 a 1894).\n\n\n\nMortes por corpo \\(\\times\\) ano\n0\n1\n2\n3\n\n\n\n\n\n109\n65\n22\n3\n\n\n\nDetermine se a distribuição Poisson é adequada para este conjunto de dados. Em caso afirmativo, estime a taxa e dê um intervalo de credibilidade de 95%.\n\n\n7.5.2 Suicídios no Amazonas considerando capital e interior\nO Amazonas possui uma característica peculiar: aproximadamente 50% da população vive na capital. Vimos anteriormente que o número de suicídios, considerando os anos entre 2021 e 2023, podem ser modelados por uma Poisson. A tabela abaixo divide esses dados entre capital e interior.\n\nNúmero de suicídios divididos entre capital e interior\n\n\nAno\n2021\n2022\n2023\nTotal\n\n\n\n\nCapital\n133\n124\n138\n395\n\n\nInterior\n164\n173\n201\n538\n\n\n\nDetermine se há evidências de que essas taxas são diferentes.\n\n\n7.5.3 Crime de estupro de vulnerável no interior do Amazonas**\nOs dados a seguir foram cedidos pelo Observatório de Violência de Gênero no Amazonas e compreendem os anos entre 2010 e 2012. A população em risco é o número de mulheres com menos de 14 anos.\n\n\n\nCidade\nVítimas\nPopulacao feminina\n\n\n\n\nAmatura\n3\n639\n\n\nAtalaia do Norte\n6\n905\n\n\nBarreirinha\n12\n1899\n\n\nBenjamin Constant\n2\n2036\n\n\nBoa Vista do Ramos\n6\n1060\n\n\nFonte Boa\n0\n1438\n\n\nJutai\n1\n1143\n\n\nMaues\n13\n3421\n\n\nNhamunda\n9\n1168\n\n\nParintins\n20\n6700\n\n\nSanto Antonio do Ica\n7\n1608\n\n\nSao Paulo de Olivenca\n5\n2033\n\n\nTabatinga\n8\n3095\n\n\nTonantins\n1\n1186\n\n\n\nVerifique se é possível utilizar uma única taxa para explicar este banco de dados. Em caso contrário, estime uma taxa para cada município. O que você pode destacar de sua análise?",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  },
  {
    "objectID": "poisson.html#o-modelo-poisson-para-taxas",
    "href": "poisson.html#o-modelo-poisson-para-taxas",
    "title": "7  O modelo Poisson",
    "section": "7.4 O modelo Poisson para taxas",
    "text": "7.4 O modelo Poisson para taxas\n\n7.4.1 Modelo de taxa única\nA taxa é o quociente entre o número de casos de um evento em determinado intervalo de tempo e a população em risco, definida em um espaço e no mesmo intervalo de tempo “pessoas-tempo”. Note que, pela definição, a taxa é uma estatística.\nSeja \\(N\\) o tamanho da população no espaço/tempo e seja \\(y\\) o número de casos do evento de interesse. Então,\n\\[\\hbox{taxa} = \\frac{y}{N}\\]\nContudo, como \\(N\\) tende a ser muito maior que \\(y\\), é comum reportar a taxa vezes \\(10^k\\), para algum \\(k&gt;0\\). O mais comum é ter \\(k=5\\) e esta convenção é adotada aqui.\n\nCrime de estupro no país Segundo o Anuário de Segurança Pública 2023, em 2022 houveram 74.930 casos de estupro. Considerando uma população de 208,2 milhões de habitantes, a taxa de estupro para aquele ano foi de \\[\\frac{68.885}{208.200.000}\\times 10^{-5}=35,98\\] casos por pessoa-ano.\nPortanto, temos uma taxa de 35,98 casos para cada 100.000 habitantes.\n\nAgora, considere que \\(\\lambda\\) é o parâmetro taxa. Então,\n\\[\\hat{\\lambda}=\\frac{y}{N}\\] é a estimativa para \\(\\lambda\\). Como \\(y\\) é uma contagem, é razoável supor que \\[\\lambda =\\frac{1}{N}E(Y|\\lambda),\\] e um modelo com essa parametrização seria \\(y|\\lambda\\sim\\hbox{Poisson}(\\lambda N)\\). Observe que, na prática \\(N\\) já está dividido por \\(10^5\\).\n\nCrime de estupro no país (cont.) Seja \\(y\\) o número de crimes de estupro dados no exemplo anterior. Seja \\(n=212.700.000/10^5=2082\\) a população do país dividida por \\(10^5\\). Considerando o modelo \\(y|\\lambda\\hbox{Poisson}(2082\\lambda)\\) temos a seguinte verossimilhança para \\(\\lambda\\):\n\\[L(\\lambda)\\propto \\lambda^{74930}e^{-2082\\lambda  }\\] Utilizando a priori Gama(1,1) (que representa um caso para cada 100.000 habitantes), teremos a posteriori Gama(74931,2083) e a estimativa \\[E(\\lambda|y)=\\frac{74931}{2083}=35,97.\\] ou seja, 35,97 casos a cada 100.000 habitantes.\n\nAgora, considere que a população está particionada em \\(m\\) localidades. Sejam \\(N_i\\) e \\(y_i\\) a população da localidade \\(i\\) e seu respectivo número de casos observados. Suponha ainda que a taxa \\(\\lambda\\) é comum para a população e que \\(y_i\\) e \\(y_j\\) são independentes dado \\(\\lambda\\). Assumindo a distribuição Poisson, teremos\n\\[L(\\lambda)=\\prod_{i=1}^m\\frac{e^{-\\lambda n_i}(\\lambda N_i)^{y_i}}{y_i!}\\varpropto \\lambda^{\\sum_{i=1}^m y_i}e^{-\\lambda \\sum_{i=1}^m N_i}=\\lambda^{\\sum_{i=1}^n y_i}e^{-\\lambda N},\\] onde \\(N=\\sum_{i=1}^m N_i\\) é o tamanho da população. Como a verossimilhança pertence à família exponencial, temos que o modelo Gama\\((r,s)\\) é conjugado gerando a posteriori\n\\[\\lambda|\\mathbf{y}\\sim\\hbox{Gama}\\left(\\sum_{i=1}^{m}y_i+r,N+s\\right)\\equiv \\hbox{Gamma}(r_1,s_1).\\] Observe que essa posteriori é identica a obtida no exemplo anterior, quando consideramos o número de casos na população.\nConsidere agora um novo valor observado da localidade \\(i\\). Sua preditiva a posteriori é dada por\n\\[\\begin{align}\nf(y^*_i|\\boldsymbol{y})&=\\int_0^\\infty f(y^*_i|\\lambda)f(\\lambda|\\boldsymbol{y})d\\lambda\\\\\n&\\int_0^\\infty \\frac{e^{-\\lambda N_i}(\\lambda N_i)^{y_i^*}}{y_i^*!}\\frac{s_1^{r_1}}{\\Gamma(r_1)}\\lambda^{r_1-1}e^{-\\lambda s_1}d\\lambda\\\\\n&=\\frac{\\Gamma(r_1+y_i^*)}{y_i^*!\\Gamma(r_1)}\\left(\\frac{s_i}{N_i+s_i}\\right)^{r_1}\\left(1-\\frac{s_i}{N_i+s_i}\\right)^{y_i^*},\n\\end{align}\\] ou seja, \\[y_i^*|\\boldsymbol{y}\\sim\\text{Binomial Negativa}\\left(r_1,\\frac{s_1}{N_i+s_1}\\right),\\] cujo valor esperado é \\[E(y_i^*|\\boldsymbol{y})=\\frac{r_1}{s_1}N_i.\\]\nDeste modo, a taxa da preditiva a posteriori é dada por \\[E(\\frac{y_i^*}{N_i}|\\boldsymbol{y})=\\frac{r_1}{s_1}\\] e podemos comparar o ajuste considerando a distribuição de \\(y^*_i/N_i\\) com \\(y_i/N_i\\).\n\nCrime de estupro no país (cont.) Os dados deste exemplo estão no banco abaixo.\n\nrequire(gsheet)\n\nCarregando pacotes exigidos: gsheet\n\nurl &lt;- 'https://docs.google.com/spreadsheets/d/11Sr8mqilWCe6Dj8TO6PgTYpJT292vbon1XnB0Co1Trc/edit?usp=sharing'\n\ndados &lt;- data.frame(gsheet2tbl(url))\n\nNo encoding supplied: defaulting to UTF-8.\n\nprint(dados)\n\n   Unidade.Federativa..UF. População.Estimada..2023. Crimes.de.estupro\n1                     Acre                    830018               745\n2                  Alagoas                   3127511              1040\n3                    Amapá                    733759               628\n4                 Amazonas                   4145525               836\n5                    Bahia                  14659023              4558\n6                    Ceará                   9187078              1897\n7         Distrito Federal                   2817068               754\n8           Espírito Santo                   4018650              1736\n9                    Goiás                   7206589              3667\n10                Maranhão                   6775152              2273\n11             Mato Grosso                   3784239              1889\n12      Mato Grosso do Sul                   2756700              2191\n13            Minas Gerais                  20812060              4491\n14                    Pará                   8442765              4557\n15                 Paraíba                   4039277               546\n16                  Paraná                  11835799              6648\n17              Pernambuco                   9496294              2705\n18                   Piauí                   3280062              1241\n19          Rio de Janeiro                  16615526              5627\n20     Rio Grande do Norte                   3302970               881\n21       Rio Grande do Sul                  11088065              5193\n22                Rondônia                   1616379              1027\n23                 Roraima                    636303               726\n24          Santa Catarina                   7762154              4541\n25               São Paulo                  45533984             12615\n26                 Sergipe                   2240560               885\n27               Tocantins                   1496880              1033\n\n\nUtilizando a posteriori Gama(74931,2083), teremos que \\[y_i^*|\\hbox{dados}\\sim\\hbox{Binomial Negativa}\\left(74931,\\frac{2083}{N_i+2083}\\right).\\]\nPodemos construir intervalos de 95% (de predição) para \\(y^*_i\\) utilizando os quantis da preditiva a posteriori, ou seja, encontrando \\(q_1\\) e \\(q_2\\) tais que \\[\\begin{align}\nP(Y_i^*\\leq q_1|\\boldsymbol{y})&=0,025\\\\\nP(Y_i^*\\leq q_2|\\boldsymbol{y})&=0,975.\n\\end{align}\n\\]\nObserve ainda que \\[0,95\\approx P(q_1\\leq Y_i^*\\leq q_2|\\boldsymbol{y})=P\\left(\\frac{q_1}{N_i}\\leq \\frac{Y_i^*}{N_i}\\leq \\frac{q_2}{N_i}|\\boldsymbol{y}\\right),\\] o que implica que \\((q_1,q_2)/N_i\\) é um intervalo de predição de 95% para taxa esperada. Abaixo construímos estes intervalos e contrastamos com a taxa observada.\n\n# taxas observadas\nN &lt;- unlist(dados[,2]/100000)\ntaxas &lt;- unlist(dados[,3]/N)\n\n# posteriori\nr1 = 74931\ns1 = 2083\n\n# limites do intervalo da preditiva a posteriori\nlim_inf &lt;- qnbinom(.025, size = r1, prob = s1/(N+s1))\nlim_sup &lt;- qnbinom(.975, size = r1, prob = s1/(N+s1))\n\n# gráfico\ncores = c('red','green4','red',rep('orange',4),'red','red','green4',\n          'red','red',rep(c('orange','red'),2), 'orange','green4','green4','orange',rep('red',4),'orange','green4','red')\nplot.new()\nplot.window( xlim = c(-70,120), ylim=c(0,27))\nsegments(lim_inf/N,1:27,lim_sup/N,1:27, lwd = 2)\ntext(-70,1:27, unlist(dados[,1]), adj =0 ,col=cores)\npoints(taxas, 1:27, pch = 22, cex =.9, bg = cores)\naxis(1,at = seq(0,120,20))\n\n\n\n\n\n\n\n\nObserve que o modelo de considera uma taxa única para o país se ajusta bem para os estados Alagoas, Maranhão, Piauí, Rio de Janeiro e Sergipe. Unidades da Federação como Amazonas, Bahia, Ceará, Distrito Federal, Minas Gerais, Pernambuco, Rio Grande do Norte e São Paulo, possuem taxas menores do que as preditas. Os demais estados possuem taxas maiores do que as preditas.\n\n\n\n7.4.2 Modelo com uma taxas por localidade\nO último exemplo da seção anterior mostra que o modelo com taxa única pode ser falho. Existem algumas explicações para este fenômeno, como:\n\nO evento observado não depende apenas do tamanho da população. O crime de estupro, por exemplo, depende de variáveis como vunerabilidade social e aparelhamento do estado para o acolhimento das vítimas.\nO evento observado pode ser raro. Eventos raros são mais difíceis de serem observados em populações menores, o que causa distorções.\n\nPodemos tentar mitigar os efeitos acima considerando um modelo no qual cada região possui sua própria taxa, i.e.\n\\[y_i|\\lambda_i\\sim\\hbox{Poisson}(\\lambda_i N_i).\\] Considerando a priori \\(\\lambda_i\\sim\\hbox{Gama}(r,s)\\), teremos\n\\[\\begin{align}\n\\lambda_i| \\hbox{dados} & \\sim \\hbox{Gama}(r+y_i,s+N_i)\\\\\ny^*_i|\\hbox{Dados}&\\sim\\hbox{Binomial Negativa}\\left(r+y_i,\\frac{s}{s+N_i}\\right)\n\\end{align}\\]\nObserve que mesmo que cada região tenha a sua própria taxa, a informação a priori é a mesma para todas elas. Deste modo, é importante que a priori reflita as várias possibilidades de taxas.\n\nCrime de estupro no país (cont.) Considere que as taxas para cada unidade da federação são independentes e identicamente distribuídas. Abaixo apresentamos a densidade estimada via método do núcleo para as taxas.\n\nplot(density(taxas))\ncurve(dgamma(x,100,.5),add = T)\n\n\n\n\n\n\n\n\nVimos na Introdução que uma priori Gama\\((r,s)\\) pode ser elicitada utilizando as seguintes fórmulas:\n\\[\\begin{align}a&=\\left(\\frac{\\hbox{média}}{desvio}\\right)^2\\\\\nb=\\frac{a}{\\hbox{média}}\\end{align}\\]\nFazendo os cálculos abaixo\n\nmedia = mean(taxas)\ndesvio = sd(taxas)\nr = (media/desvio)^2\ns = r/media\nr;s\n\n[1] 3.608031\n\n\n[1] 0.07758706\n\n\nA próxima figura reapresenta a densidade estimada em conjunto com a densidade Gama(3,6;,;0,07)\n\nplot(density(taxas))\ncurve(dgamma(x,3.6,.07),add = T, lwd = 2, col ='tomato')\n\n\n\n\n\n\n\n\nVamos utilizar a priori \\(\\lambda_i\\sim\\hbox{Gama}(3,6\\;,\\;0,07)\\) para analizar este banco de dados, agora com múltiplas taxas.\n\n# hiperparametros\nr = 3.6\ns = .07\n\n# posterioris\nr1 = unlist(dados[,3])+r\ns1 = N + s\n\n# limites do intervalo da preditiva a posteriori\nlim_inf &lt;- qnbinom(.025, size = r1, prob = s1/(N+s1))\nlim_sup &lt;- qnbinom(.975, size = r1, prob = s1/(N+s1))\n\n# gráfico\ncores = c('red','green4','red',rep('orange',4),'red','red','green4',\n          'red','red',rep(c('orange','red'),2), 'orange','green4','green4','orange',rep('red',4),'orange','green4','red')\nplot.new()\nplot.window( xlim = c(-70,120), ylim=c(0,27))\nsegments(lim_inf/N,1:27,lim_sup/N,1:27, lwd = 2)\ntext(-70,1:27, unlist(dados[,1]), adj =0 ,col=cores)\npoints(taxas, 1:27, pch = 22, cex =.9, bg = cores)\naxis(1, at=seq(0,120,20))\n\n\n\n\n\n\n\n\nAs múltiplas taxas apresentam um cenário mais honesto, acomodando cada estado a sua própria realidade. Abaixo, apresentamos um mapa com a taxa estimada.\n\n# Carregar as bibliotecas necessárias\nlibrary(leaflet)\nlibrary(geobr)\n\nCarregando namespace exigido: sf\n\n# Obter os dados geográficos das Unidades da Federação do Brasil usando geobr\nbrasil_uf &lt;- read_state() # Ou o ano mais recente disponível\n\nUsing year/date 2010\n\n# colocar os estados em ordem alfabética\nbrasil_uf &lt;- brasil_uf[order(brasil_uf$name_state), ]\n\n# adicionar as taxas\nbrasil_uf$taxa &lt;- r1/s1\n\n# Definir uma paleta de cores com base nos valores das taxas\npal &lt;- colorNumeric(palette = \"viridis\", domain = brasil_uf$taxa)\n\n# Criar o mapa leaflet\nmapa_leaflet &lt;- leaflet(brasil_uf) %&gt;%\n  setView(lng = -55, lat = -15, zoom = 3) %&gt;% # Centralizar o mapa no Brasil\n  addTiles() %&gt;% # Adicionar camadas de mapa base (OpenStreetMap por padrão)\n  addPolygons(\n    fillColor = ~pal(taxa),\n    weight = 1,\n    color = \"#000000\",\n    fillOpacity = 0.7,\n    label = ~paste0(name_state, \": \", round(taxa, 2)), # Adicionar rótulos ao passar o mouse\n    highlightOptions = highlightOptions(color = \"white\", weight = 2, bringToFront = TRUE)\n  ) %&gt;%\n  addLegend(pal = pal, values = ~taxa, title = \"Taxa\", opacity = 1)\n\nWarning: sf layer has inconsistent datum (+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs).\nNeed '+proj=longlat +datum=WGS84'\n\n# Exibir o mapa (opcional, se você estiver em um ambiente interativo)\nmapa_leaflet\n\n\n\n\n\n\n\n\n7.4.3 Análise de agrupamentos para taxas\nAté o momento estudamos dois exemplos extremos:\n\nUm modelo com uma única taxa por localidade\nUm modelo com uma taxa por localidade\n\nUm modo útil para deicidir qual abordagem é a mais interessante é o uso de um critério de informação. Recordemos que tais critério são escritos como\n\\[-2\\log L(\\hat{\\theta})+2k,\\] onde \\(L(\\theta)\\) é a função de verossimilhança, \\(\\hat{\\theta}\\) é uma estimativa para \\(\\theta\\) e \\(k\\) é uma penalidade relacionada ao número de parâmetros do modelo. Por causa do sinal negativo em \\(L(.)\\), temos que o modelo preferível é aquele com menor valor do critério.\nEm inferência bayesiana é comum o uso do Critério de Informação de Desvio (DIC), onde \\(\\hat{\\theta}=E(\\theta|\\boldsymbol{x})\\) e \\[k=\\frac{1}{2}Var_{\\theta|\\boldsymbol{x}}(\\log L(\\theta)).\\]\nObserve que o cálculo direto de \\(k\\) não é trivial. Entretanto, o DIC pode ser facilmente obtido via o Método de Monte Carlo.\n\nAlgoritmo: Calculando o DIC via Monte Carlo\n\nSimule \\(\\theta_1,\\ldots,\\theta_B\\) da distribuição a posteriori de \\(\\theta\\).\nEstime \\(E(\\theta|\\boldsymbol{x})\\) por \\[\\hat{\\theta}=\\frac{1}{B}\\sum_{j=1}^B \\theta_j\\]\nFaça \\(v_j=-2\\log L(\\theta_j)\\). Estime \\(k\\) por \\[k=\\frac{1}{2B}\\sum_{j=1}^B(v_j-\\bar{v})^2\\]\nCalcule o DIC:\n\n\\[DIC=-2\\log L(\\hat{\\theta})+2k.\\]\n\n\nComparando os dois modelos para as taxas\nNo começo desta seção, estudamo a taxa de crimes de estupro no Brasil, considerando uma única taxa \\(\\lambda\\) comum a todas as unidades da federação. Encontramos a posteriori \\(\\lambda\\sim\\hbox{Gama}(74931,2083)\\). O DIC para este modelo é\n\nB = 10000 # número de simulações\nlambda &lt;- rgamma( B, 74931, 2083) # simulações da posteriori\n\n# média a posteriori\nlambda_chapeu &lt;- mean(lambda)\n\n# calculo de k\nvj &lt;- sapply( lambda, function(l) -2*sum(dpois( dados[,3], l*N, log = T)))\nk &lt;- .5*var(vj)\n\nDIC0 &lt;- -2*sum( dpois(dados[,3], lambda_chapeu*N, log = T) ) +2*k\nDIC0\n\n[1] 11771.55\n\n\nPosteriormente, criamos um modelo com uma taxa por unidade da federação. Para a \\(i\\)ésima unidade, a posteriori da taxa foi dada ´por \\(\\lambda_i\\sim\\hbox{Gama}(y_i+3,6\\;\\;,\\;\\;N_i+0,07)\\). O DIC para este modelo é\n\nB = 10000 # número de simulações\n# hiperparâmetros comuns\nr = 3.6\ns = .07\n\n# simulações da posteriori\nlambda &lt;- sapply(1:B, function(x) rgamma(27, dados[,3]+3.6, N+.07) )\n\n# média a posteriori para cada taxa\nlambda_chapeu &lt;- rowMeans(lambda)\n\n# calculo de k\nvj &lt;- apply( lambda, 2, function(l) -2*sum(dpois( dados[,3], l*N, log = T)))\nk &lt;- .5*var(vj)\n\nDICtodos &lt;- -2*sum( dpois(dados[,3], lambda_chapeu*N, log = T) ) +2*k\nDICtodos\n\n[1] 307.3943\n\n\nObserve que o modelo com uma taxa por unidade da federação possui o menor valor do DIC, sendo assim o mais parcimonioso entre os dois.\n\nSeja \\(S=\\{1,\\ldots,m\\}\\) o conjunto das \\(m\\) localidades. Suponha que é razoável particionar \\(S\\) e \\(k\\) grupos. Por último, considere que todas as localidades dentro de uma partição compartilham a mesma taxa, ou seja, para \\(j\\) dentro da partição \\(S_t\\), tem-se que \\(y_i|\\lambda_t\\sim\\hbox{Poisson}(\\lambda_tN_i)\\), onde \\(\\lambda_t\\sim\\hbox{Gama}(r_t,s_t)\\). O desafio aqui é determinar se a localidade pertence à partição \\(S_t\\).\nConsidere que a localidade \\(i\\) pertence à partição \\(t\\). Defina o vetor coluna \\(z_i\\), de comprimento de comprimento \\(k\\), composto de zeros exceto na coordenada \\(t\\), que vale 1. Defina \\(z_{i,s}\\) como a \\(s\\)-ésima coordenada do vetor \\(z_i\\). Então\n\\[\\prod_{j=1}^k \\lambda_j^{z_{i,j}}=\\lambda_t=\\sum_{j=1}^k \\lambda_j z_{i,j}.\\] Deste modo, temos que \\(y_i|z_i,\\lambda\\sim\\hbox{Poisson}(\\prod_{j=1}^k\\lambda_j^{z_{i,j}} N_i)\\). e a função de verossimilhança é dada por\n\\[L(\\lambda,z)=\\prod_{i=1}^m \\frac{e^{-\\sum_{j=1}^k\\lambda_jz_{i,j}N_i}[\\prod_{j=1}^k \\lambda_j^{z_{i,j}} N_i]^{y_i}}{y_i!}\\propto \\prod_{i=1}^m \\left[\\prod_{j=1}^ke^{-\\lambda_jz_{i,j}N_i}\\right]\\left[\\prod_{j=1}^k \\lambda_j^{z_{i,j}} N_i\\right]^{y_i}=\\prod_{j=1}^k e^{-\\lambda_j\\sum_{i=1}^m z_{i,j}N_i}\\lambda_j^{\\sum_{i=1}^m z_{i,j}y_i}\\] Observe que \\(z_j\\) é desconhecido e vamos tratá-lo como parâmetro. Pela sua natureza, pode-se pensar em utilizar a priori \\(z_j\\sim\\hbox{Bernoulli Multivariada}(p_1,\\ldots,p_k)\\).\nVamos assumir que a priori de \\(z_1,\\ldots,z_m\\) é independente da priori \\(\\lambda_1,\\ldots,\\lambda_k\\).\nPara determinar a posteriori de \\((\\lambda,z)\\), observe que\n\\[\\begin{align}f(\\lambda,z|\\boldsymbol{y})&\\propto L(\\lambda,z)f(\\lambda)f(z)\\\\&\\propto\\prod_{j=1}^k e^{-\\lambda_j\\sum_{i=1}^m z_{i,j}N_i}\\lambda_j^{\\sum_{i=1}^m z_{i,j}y_i}\\prod_{j=1}^k \\lambda_j^{r_j-1}e^{-\\lambda_js_j}\\prod_{i=1}^m \\prod_{j=1}^k p_j^{z_{i,j}}\\end{align}\\] Note que \\[f(\\lambda|z,\\boldsymbol{y})\\]\n\\(z_i\\sim\\hbox{Bernoulli Multivariada}(p_1,\\ldots,p_k)\\)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  },
  {
    "objectID": "poisson.html#exercícios",
    "href": "poisson.html#exercícios",
    "title": "7  O modelo Poisson",
    "section": "7.5 Exercícios",
    "text": "7.5 Exercícios\n\n7.5.1 Mortes por coice de cavalo\nLadislaus Bortkiewicz é o responsável pela popularização da distribuição Poisson. Em seu livro intitulado A Lei dos Pequenos Números, é apresentado um conjunto de dados no qual foi rastreado o número de mortes por coice de cavalo em 14 corpos do exército prussiano ao longo de 20 anos (de 1875 a 1894).\n\n\n\nMortes por corpo \\(\\times\\) ano\n0\n1\n2\n3\n\n\n\n\n\n109\n65\n22\n3\n\n\n\nDetermine se a distribuição Poisson é adequada para este conjunto de dados. Em caso afirmativo, estime a taxa e dê um intervalo de credibilidade de 95%.\n\n\n7.5.2 Suicídios no Amazonas considerando capital e interior\nO Amazonas possui uma característica peculiar: aproximadamente 50% da população vive na capital. Vimos anteriormente que o número de suicídios, considerando os anos entre 2021 e 2023, podem ser modelados por uma Poisson. A tabela abaixo divide esses dados entre capital e interior.\n\nNúmero de suicídios divididos entre capital e interior\n\n\nAno\n2021\n2022\n2023\nTotal\n\n\n\n\nCapital\n133\n124\n138\n395\n\n\nInterior\n164\n173\n201\n538\n\n\n\nDetermine se há evidências de que essas taxas são diferentes.\n\n\n7.5.3 Crime de estupro de vulnerável no interior do Amazonas**\nOs dados a seguir foram cedidos pelo Observatório de Violência de Gênero no Amazonas e compreendem os anos entre 2010 e 2012. A população em risco é o número de mulheres com menos de 14 anos.\n\n\n\nCidade\nVítimas\nPopulacao feminina\n\n\n\n\nAmatura\n3\n639\n\n\nAtalaia do Norte\n6\n905\n\n\nBarreirinha\n12\n1899\n\n\nBenjamin Constant\n2\n2036\n\n\nBoa Vista do Ramos\n6\n1060\n\n\nFonte Boa\n0\n1438\n\n\nJutai\n1\n1143\n\n\nMaues\n13\n3421\n\n\nNhamunda\n9\n1168\n\n\nParintins\n20\n6700\n\n\nSanto Antonio do Ica\n7\n1608\n\n\nSao Paulo de Olivenca\n5\n2033\n\n\nTabatinga\n8\n3095\n\n\nTonantins\n1\n1186\n\n\n\nVerifique se é possível utilizar uma única taxa para explicar este banco de dados. Em caso contrário, estime uma taxa para cada município. O que você pode destacar de sua análise?",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>O modelo Poisson</span>"
    ]
  }
]